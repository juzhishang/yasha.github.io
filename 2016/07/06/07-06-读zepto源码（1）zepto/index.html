<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="小前端，on my way~">
  <meta name="keyword" content="hexo-theme, vuejs">
  <title>
    
      读zepto源码（1）zepto | 鸦杀&#39;s Blog
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <!--<div class="logo"></div>-->
      <span>鸦杀's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>读zepto源码（1）zepto</h2>
  <p class="post-date">2016-07-06</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>四月份的时候，部门开展了一次读源码活动。后来由于需求越来越多且架构调整，原来的小伙伴都被拆分到不同的项目组去了。zepto源码当时大家计划是读完核心代码、event、ajax…结果就是连核心代码的四分之一都没有读完…</p>
<p>好吧，不吐槽了，因为我自己也是断断续续的，一直到上周才读完核心的部分。</p>
<hr>
<p>zepto号称是移动端的jquery，所以我是很想认真的把它读一遍，然后比较下它和jquery，当然这个目标实现起来有点困难╮(﹁_﹂)╭</p>
<p>不说废话了。</p>
<p>首先它定义了一个Zepto对象，通过window.Zepto=Zepto将Zepto绑定到全局window下。<br>在window.$不存在的时候，才会把Zepto绑定到window.$下，我想，这是为了给jQuery让路吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var Zepto=(function()&#123;//...&#125;)()  </span><br><span class="line">window.Zepto = Zepto  </span><br><span class="line">window.$ === undefined &amp;&amp; (window.$ = Zepto)</span><br></pre></td></tr></table></figure>
<p>Zepto是一个匿名自执行函数，它的内部环境中，我觉得最重要的三个对象是：zepto、$、Z。</p>
<h3 id="Z是一个构造器"><a href="#Z是一个构造器" class="headerlink" title="Z是一个构造器"></a>Z是一个构造器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> function Z(dom, selector) &#123;  </span><br><span class="line"> //这里添加的都是对象自身的属性  </span><br><span class="line"> //dom存在，len为dom的length，否则len为0  </span><br><span class="line"> var i, len = dom ? dom.length : 0  </span><br><span class="line"> //添加数字属性，存DOM元素储  </span><br><span class="line"> for (i = 0; i &lt; len; i++) this[i] = dom[i]  </span><br><span class="line"> //添加length与selector属性  </span><br><span class="line"> this.length = len  </span><br><span class="line"> this.selector = selector || &apos;&apos;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="zepto是核心，看一下我觉得比较关键的几个方法："><a href="#zepto是核心，看一下我觉得比较关键的几个方法：" class="headerlink" title="zepto是核心，看一下我觉得比较关键的几个方法："></a>zepto是核心，看一下我觉得比较关键的几个方法：</h3><ul>
<li>zepto.Z:返回Z的实例</li>
<li>zepto.isZ:判断继承关系</li>
<li>zepto.init:初始化，内部调用了zepto.Z</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> zepto.Z = function(dom, selector) &#123;  </span><br><span class="line"> //返回Z的实例  </span><br><span class="line"> return new Z(dom, selector)  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.isZ` should return `true` if the given object is a Zepto  </span><br><span class="line"> // collection. This method can be overridden in plugins.  </span><br><span class="line"> //http://www.ibm.com/developerworks/cn/web/1306_jiangjj_jsinstanceof/  </span><br><span class="line"> zepto.isZ = function(object) &#123;  </span><br><span class="line"> //这里用zepto.Z而不是Z，大概是因为zepto.Z可以被重新吧  </span><br><span class="line"> //判断object是否是zepto.Z的实例,看它的原型链，是否是zepto.z.prototype  </span><br><span class="line"> //object.__proto__ === zepto.Z.prototype↘  </span><br><span class="line"> //object.__proto__.__proto__===zepto.Z.prototype  </span><br><span class="line"> return object instanceof zepto.Z  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.init` is Zepto&apos;s counterpart to jQuery&apos;s `$.fn.init` and  </span><br><span class="line"> // takes a CSS selector and an optional context (and handles various  </span><br><span class="line"> // special cases).  </span><br><span class="line"> // This method can be overridden in plugins.  </span><br><span class="line"> zepto.init = function(selector, context) &#123;  </span><br><span class="line"> //...  </span><br><span class="line"> //返回Z的实例  </span><br><span class="line"> return zepto.Z(dom, selector)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里很有意思，命名zepto.Z执行的是new Z()，为什么zepto.isZ判断继承关系是用zepto.Z而不是Z呢，关键在一句<code>zepto.Z.prototype = Z.prototype = $.fn</code>，我们先不去看$.fn是什么鬼，这里zepto.Z.prototype = Z.prototype就是原因。因为instanceof判断继承关系实际上看的就是原型链。</p>
<h3 id="是这个匿名自执行函数对外暴露的一个接口。"><a href="#是这个匿名自执行函数对外暴露的一个接口。" class="headerlink" title="是这个匿名自执行函数对外暴露的一个接口。"></a>是这个匿名自执行函数对外暴露的一个接口。</h3><p>$它自身是一个函数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//返回zepto.init的调用结果  </span><br><span class="line">$ = function(selector, context) &#123;  </span><br><span class="line"> return zepto.init(selector, context)  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，我们调用$()就能拿到zepto.Z的实例。</p>
<p>$上又有很多属性和方法，这里不一一列举。我们直接通过$.xxx调用，而不需要生成zepto.Z的实例。所以，这可以认为是一些工具方法和全局属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Object.keys($)  </span><br><span class="line">/*[&quot;extend&quot;, &quot;contains&quot;, &quot;type&quot;, &quot;isFunction&quot;, &quot;isWindow&quot;, &quot;isArray&quot;, &quot;isPlainObject&quot;, &quot;isEmptyObject&quot;, &quot;inArray&quot;, &quot;camelCase&quot;, &quot;trim&quot;, &quot;uuid&quot;, &quot;support&quot;, &quot;expr&quot;, &quot;noop&quot;, &quot;map&quot;, &quot;each&quot;, &quot;grep&quot;, &quot;parseJSON&quot;, &quot;fn&quot;, &quot;zepto&quot;, &quot;event&quot;, &quot;proxy&quot;, &quot;Event&quot;, &quot;active&quot;, &quot;ajaxJSONP&quot;, &quot;ajaxSettings&quot;, &quot;ajax&quot;, &quot;get&quot;, &quot;post&quot;, &quot;getJSON&quot;, &quot;param&quot;, &quot;expando&quot;] */</span><br></pre></td></tr></table></figure>
<p>其中$有一个fn对象，这个fn对象上也挂了很多属性和方法。我们发现，$.fn实际上就是zepto.Z的实例的原型，为什么呢，还有由于这句<code>zepto.Z.prototype = Z.prototype = $.fn</code>，它重写了zepto.Z和Z的prototype。</p>
<p>而<code>$.zepto = zepto</code>这句，又把核心对象zepto暴露了出来。</p>
<h3 id="最后，放下核心代码的注释："><a href="#最后，放下核心代码的注释：" class="headerlink" title="最后，放下核心代码的注释："></a>最后，放下核心代码的注释：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br></pre></td><td class="code"><pre><span class="line">//     Zepto.js  </span><br><span class="line">//     (c) 2010-2016 Thomas Fuchs  </span><br><span class="line">//     Zepto.js may be freely distributed under the MIT license.  </span><br><span class="line">//核心，返回Zepto集合  </span><br><span class="line">var Zepto = (function() &#123;  </span><br><span class="line"> /*  </span><br><span class="line"> 定义变量  </span><br><span class="line"> */  </span><br><span class="line"> var undefined, //未定义  </span><br><span class="line"> key,  </span><br><span class="line"> $, //DOM操作对象，重要  </span><br><span class="line"> classList,//存储className  </span><br><span class="line"> emptyArray = [], //空数组  </span><br><span class="line"> concat = emptyArray.concat,  </span><br><span class="line"> filter = emptyArray.filter,  </span><br><span class="line"> slice = emptyArray.slice,  </span><br><span class="line"> document = window.document, //缓存document  </span><br><span class="line"> elementDisplay = &#123;&#125;, //存储各个标签的默认display值  </span><br><span class="line"> classCache = &#123;&#125;, //缓存class  </span><br><span class="line"> cssNumber = &#123; //这些css属性赋值时不自动加px  </span><br><span class="line"> &apos;column-count&apos;: 1,  </span><br><span class="line"> &apos;columns&apos;: 1,  </span><br><span class="line"> &apos;font-weight&apos;: 1,  </span><br><span class="line"> &apos;line-height&apos;: 1,  </span><br><span class="line"> &apos;opacity&apos;: 1,  </span><br><span class="line"> &apos;z-index&apos;: 1,  </span><br><span class="line"> &apos;zoom&apos;: 1  </span><br><span class="line"> &#125;,  </span><br><span class="line"> fragmentRE = /^\s*]*&gt;/, //html片段  </span><br><span class="line"> singleTagRE = /^(?:|)$/, //标签  </span><br><span class="line"> //非闭合标签的闭合写法，虽然说法不太准确  </span><br><span class="line"> //这里[\w:]中冒号的情况比如&apos;svg:svg&apos;  </span><br><span class="line"> //  </span><br><span class="line"> //    </span><br><span class="line"> //  </span><br><span class="line"> tagExpanderRE = /]*)\/&gt;/ig,  </span><br><span class="line"> rootNodeRE = /^(?:body|html)$/i, //根节点  </span><br><span class="line"> capitalRE = /([A-Z])/g, //大写  </span><br><span class="line">  </span><br><span class="line"> // special attributes that should be get/set via method calls  </span><br><span class="line"> //这里是方法名称数组，它们通过遍历调用的方式设置的，调用时取值和  </span><br><span class="line"> methodAttributes = [&apos;val&apos;, &apos;css&apos;, &apos;html&apos;, &apos;text&apos;, &apos;data&apos;, &apos;width&apos;, &apos;height&apos;, &apos;offset&apos;],  </span><br><span class="line">  </span><br><span class="line"> //dom插入操作名称  </span><br><span class="line"> adjacencyOperators = [&apos;after&apos;, &apos;prepend&apos;, &apos;before&apos;, &apos;append&apos;],//其实它跟jquery一样也有appendTo,prependTo,insertAfter,insertBefore  </span><br><span class="line"> table = document.createElement(&apos;table&apos;), //创建table标签  </span><br><span class="line"> tableRow = document.createElement(&apos;tr&apos;), //创建tr标签  </span><br><span class="line"> containers = &#123; //父级标签  </span><br><span class="line"> &apos;tr&apos;: document.createElement(&apos;tbody&apos;),  </span><br><span class="line"> &apos;tbody&apos;: table,  </span><br><span class="line"> &apos;thead&apos;: table,  </span><br><span class="line"> &apos;tfoot&apos;: table,  </span><br><span class="line"> &apos;td&apos;: tableRow,  </span><br><span class="line"> &apos;th&apos;: tableRow,  </span><br><span class="line"> &apos;*&apos;: document.createElement(&apos;div&apos;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> readyRE = /complete|loaded|interactive/, //请求ready状态的正则  </span><br><span class="line"> simpleSelectorRE = /^[\w-]*$/, //匹配简单的class  </span><br><span class="line"> class2type = &#123;&#125;, //这里有一个内置对象的内部属性[[class]]的概念，这个对象用来做class值到类型的映射  </span><br><span class="line"> toString = class2type.toString, //Object原型上的toString方法  </span><br><span class="line"> zepto = &#123;&#125;,//很重要  </span><br><span class="line"> camelize, //驼峰  </span><br><span class="line"> uniq, //唯一  </span><br><span class="line"> tempParent = document.createElement(&apos;div&apos;), //临时父元素，创建一个div标签  </span><br><span class="line"> propMap = &#123; //标签属性映射  </span><br><span class="line"> &apos;tabindex&apos;: &apos;tabIndex&apos;,  </span><br><span class="line"> &apos;readonly&apos;: &apos;readOnly&apos;,  </span><br><span class="line"> &apos;for&apos;: &apos;htmlFor&apos;,  </span><br><span class="line"> &apos;class&apos;: &apos;className&apos;,  </span><br><span class="line"> &apos;maxlength&apos;: &apos;maxLength&apos;,  </span><br><span class="line"> &apos;cellspacing&apos;: &apos;cellSpacing&apos;,  </span><br><span class="line"> &apos;cellpadding&apos;: &apos;cellPadding&apos;,  </span><br><span class="line"> &apos;rowspan&apos;: &apos;rowSpan&apos;,  </span><br><span class="line"> &apos;colspan&apos;: &apos;colSpan&apos;,  </span><br><span class="line"> &apos;usemap&apos;: &apos;useMap&apos;,  </span><br><span class="line"> &apos;frameborder&apos;: &apos;frameBorder&apos;,  </span><br><span class="line"> &apos;contenteditable&apos;: &apos;contentEditable&apos;  </span><br><span class="line"> &#125;,  </span><br><span class="line"> isArray = Array.isArray ||function(object) &#123;  </span><br><span class="line"> return object instanceof Array  </span><br><span class="line"> &#125; //是否是数组  </span><br><span class="line">  </span><br><span class="line"> zepto.matches = function(element, selector) &#123;  </span><br><span class="line"> //如果选择器为假或者元素为假或者元素的节点类型并非element，返回  </span><br><span class="line"> if (!selector || !element || element.nodeType !== 1) return false  </span><br><span class="line"> //matchesSelector用来匹配某个元素是否匹配某个选择器   </span><br><span class="line"> //这里并没有支持IE的兼容？  </span><br><span class="line"> var matchesSelector = element.webkitMatchesSelector || element.mozMatchesSelector ||  </span><br><span class="line"> element.oMatchesSelector || element.matchesSelector  </span><br><span class="line"> //如果支持，返回匹配结果  </span><br><span class="line"> if (matchesSelector) return matchesSelector.call(element, selector)  </span><br><span class="line"> // fall back to performing a selector:  </span><br><span class="line"> var match,  </span><br><span class="line"> parent = element.parentNode, //获取父节点  </span><br><span class="line"> temp = !parent //若无父节点，则判断为临时DOM  </span><br><span class="line"> //若为临时，parent指向临时父元素tempParent,parent添加element子元素  </span><br><span class="line"> if (temp)(parent = tempParent).appendChild(element)  </span><br><span class="line"> //zepto.qsa类似querySellectAll，这里qsa返回一个数组结果，我们查找返回结果中是否存在该元素  </span><br><span class="line"> //以判断是否匹配。位运算~这里的作用注意是针对-1这个值，~-1的结果为0，假值。  </span><br><span class="line"> match = ~zepto.qsa(parent, selector).indexOf(element)  </span><br><span class="line"> temp &amp;&amp; tempParent.removeChild(element) //匹配完后移除临时父元素中的子元素  </span><br><span class="line"> return match //返回匹配结果  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> function type(obj) &#123;  </span><br><span class="line"> //obj == null的两种情况：1：null，2：undefined  </span><br><span class="line"> //当String作为函数调用时，它执行的是类型转换，内部调用toString,规则如下：  </span><br><span class="line"> //http://www.ecma-international.org/ecma-262/6.0/index.html#sec-tostring  </span><br><span class="line"> //Object.prototype.toString.call(null) ==&gt; &quot;[object Null]&quot;  </span><br><span class="line"> //Object.prototype.toString.call(undefined) ==&gt; &quot;[object Undefined]&quot;  </span><br><span class="line"> return obj == null ? String(obj) :  </span><br><span class="line"> class2type[toString.call(obj)] || &quot;object&quot; //非内置对象，类型默认为‘object’  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //是否是数组  </span><br><span class="line"> function isFunction(value) &#123;  </span><br><span class="line"> return type(value) == &quot;function&quot;  </span><br><span class="line"> &#125;   </span><br><span class="line">  </span><br><span class="line"> //是否为window,window.window属性指向自身  </span><br><span class="line"> function isWindow(obj) &#123;  </span><br><span class="line"> return obj != null &amp;&amp; obj == obj.window  </span><br><span class="line"> &#125;   </span><br><span class="line"> //是否为document  </span><br><span class="line"> function isDocument(obj) &#123;  </span><br><span class="line"> return obj != null &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE  </span><br><span class="line"> &#125;   </span><br><span class="line"> //是否为对象  </span><br><span class="line"> function isObject(obj) &#123;  </span><br><span class="line"> return type(obj) == &quot;object&quot;  </span><br><span class="line"> &#125;   </span><br><span class="line"> //纯粹的对象，通过&#123;&#125;或者new Object创建。  </span><br><span class="line"> function isPlainObject(obj) &#123;   </span><br><span class="line"> return isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; Object.getPrototypeOf(obj) == Object.prototype  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //类数组，长度属性为数值  </span><br><span class="line"> //bug，未考虑function的情况  </span><br><span class="line"> function likeArray(obj) &#123;  </span><br><span class="line"> return typeof obj.length == &apos;number&apos;  </span><br><span class="line"> &#125;   </span><br><span class="line">  </span><br><span class="line"> //返回过滤掉null和undefined后的数组  </span><br><span class="line"> function compact(array) &#123;  </span><br><span class="line"> return filter.call(array, function(item) &#123;  </span><br><span class="line"> return item != null  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;   </span><br><span class="line">  </span><br><span class="line"> //数组扁平化，如果数组长度大于0，调用$.fn.concat.apply方法，否则返回数组  </span><br><span class="line"> //只能做到二级数组扁平  </span><br><span class="line"> function flatten(array) &#123;  </span><br><span class="line"> return array.length &gt; 0 ? $.fn.concat.apply([], array) : array  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //a-b转为aB，中划线可以有多个  </span><br><span class="line"> camelize = function(str) &#123;  </span><br><span class="line"> return str.replace(/-+(.)?/g, function(match, chr) &#123;  </span><br><span class="line"> return chr ? chr.toUpperCase() : &apos;&apos;  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //abC -&gt; a-bc  AbC -&gt; ab-c  </span><br><span class="line"> //可以认为是camelize的反向  </span><br><span class="line"> function dasherize(str) &#123;  </span><br><span class="line"> return str.replace(/::/g, &apos;/&apos;) //::替换成/  </span><br><span class="line"> .replace(/([A-Z]+)([A-Z][a-z])/g, &apos;$1_$2&apos;) //连续的大写字母与大写小写之间使用_分隔，AAb-&gt;A_Ab  </span><br><span class="line"> .replace(/([a-z\d])([A-Z])/g, &apos;$1_$2&apos;) //数字或小写字母与大写字母之间使用_分隔，1A-&gt;1_A  </span><br><span class="line"> .replace(/_/g, &apos;-&apos;) //_替换为-  </span><br><span class="line"> .toLowerCase() //转为小写  </span><br><span class="line"> &#125;   </span><br><span class="line">  </span><br><span class="line"> //数组去重，赞~通过比较当前下标和array.indexOf(item)下标是否相等  </span><br><span class="line"> uniq = function(array) &#123;  </span><br><span class="line"> return filter.call(array, function(item, idx) &#123;  </span><br><span class="line"> return array.indexOf(item) == idx  </span><br><span class="line"> &#125;);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //返回classCache中的name  </span><br><span class="line"> function classRE(name) &#123;  </span><br><span class="line"> //返回name的正则，先在classCache中去取，如果不在classCache中，创建正则并存储到classCache中  </span><br><span class="line"> //这里的正则匹配所有name以空字符串或者一个空格开头且以一个空字符串或空格结束  </span><br><span class="line"> return name in classCache ?  </span><br><span class="line"> classCache[name] : (classCache[name] = new RegExp(&apos;(^|\\s)&apos; + name + &apos;(\\s|$)&apos;))  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //为css属性值添加px后缀  </span><br><span class="line"> function maybeAddPx(name, value) &#123;  </span><br><span class="line"> //value为数值类型，并且name不在cssNumber中，返回value+px后缀  </span><br><span class="line"> return (typeof value == &quot;number&quot; &amp;&amp; !cssNumber[dasherize(name)]) ? value + &quot;px&quot; : value  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //http://www.zhangxinxu.com/wordpress/2012/05/getcomputedstyle-js-getpropertyvalue-currentstyle/  </span><br><span class="line"> //获取默认的display值  </span><br><span class="line"> function defaultDisplay(nodeName) &#123;  </span><br><span class="line"> var element, display  </span><br><span class="line"> if (!elementDisplay[nodeName]) &#123; //如果没有在缓存中找到  </span><br><span class="line"> element = document.createElement(nodeName) //创建该标签  </span><br><span class="line"> document.body.appendChild(element) //添加到body中  </span><br><span class="line"> //为什么使用getPropertyValue，getPropertyValue中传的参数是css样式里的书写格式，考虑float与margin-left  </span><br><span class="line"> display = getComputedStyle(element, &apos;&apos;).getPropertyValue(&quot;display&quot;) //获取默认的display值  </span><br><span class="line"> element.parentNode.removeChild(element) //移除该标签  </span><br><span class="line"> //head,meta,link,script,style  </span><br><span class="line"> display == &quot;none&quot; &amp;&amp; (display = &quot;block&quot;) //如果display为none,设置display为block  </span><br><span class="line"> elementDisplay[nodeName] = display //加入缓存  </span><br><span class="line"> &#125;  </span><br><span class="line"> return elementDisplay[nodeName] //返回display  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> function children(element) &#123;  </span><br><span class="line"> return &apos;children&apos; in element ? //如果element有children属性  </span><br><span class="line"> //将类数组转为数组，创建多少长度的数组取决于参数的length属性  </span><br><span class="line"> slice.call(element.children) :  </span><br><span class="line"> //如果没有length属性，遍历childNodes  </span><br><span class="line"> //这里$.map返回nodeType为1的节点，即元素节点  </span><br><span class="line"> $.map(element.childNodes, function(node) &#123;  </span><br><span class="line"> if (node.nodeType == 1) return node  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // 构造器，返回的是zepto数组集合  </span><br><span class="line"> function Z(dom, selector) &#123;  </span><br><span class="line"> //这里添加的都是对象自身的属性  </span><br><span class="line"> //dom存在，len为dom的length，否则len为0  </span><br><span class="line"> var i, len = dom ? dom.length : 0  </span><br><span class="line"> //添加数字属性，存DOM元素储  </span><br><span class="line"> for (i = 0; i &lt; len; i++) this[i] = dom[i]  </span><br><span class="line"> //添加length与selector属性  </span><br><span class="line"> this.length = len  </span><br><span class="line"> this.selector = selector || &apos;&apos;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> /*  </span><br><span class="line"> 绑定zepto上的静态方法  </span><br><span class="line"> */  </span><br><span class="line"> // `$.zepto.fragment` takes a html string and an optional tag name  </span><br><span class="line"> // to generate DOM nodes from the given html string.  </span><br><span class="line"> // The generated DOM nodes are returned as an array.  </span><br><span class="line"> // This function can be overridden in plugins for example to make  </span><br><span class="line"> // it compatible with browsers that don&apos;t support the DOM fully.  </span><br><span class="line"> // 将html片段转为Dom数组  </span><br><span class="line"> zepto.fragment = function(html, name, properties) &#123;  </span><br><span class="line"> var dom, nodes, container  </span><br><span class="line">  </span><br><span class="line"> // A special case optimization for a single tag  </span><br><span class="line"> //如果html片段匹配单标签，创建dom标签  </span><br><span class="line"> if (singleTagRE.test(html)) dom = $(document.createElement(RegExp.$1))  </span><br><span class="line"> if (!dom) &#123;  </span><br><span class="line"> //如果html是字符串,替换非闭合标签的闭合写法&apos;&apos;-&gt;&apos;&apos;  </span><br><span class="line"> if (html.replace) html = html.replace(tagExpanderRE, &quot;&quot;)  </span><br><span class="line"> //如果name不存在，取fragmentRE匹配的最外面的标签  </span><br><span class="line"> if (name === undefined) name = fragmentRE.test(html) &amp;&amp; RegExp.$1  </span><br><span class="line"> //如果name不在containers中（不是表格相关的标签），设为*，*的父级容器为div  </span><br><span class="line"> if (!(name in containers)) name = &apos;*&apos;  </span><br><span class="line"> container = containers[name] //获取父级容器  </span><br><span class="line"> container.innerHTML = &apos;&apos; + html //填充内容  </span><br><span class="line">  </span><br><span class="line"> //获取引用后清空container  </span><br><span class="line"> dom = $.each(slice.call(container.childNodes), function() &#123;  </span><br><span class="line"> //移除container子元素  </span><br><span class="line"> container.removeChild(this)  </span><br><span class="line">  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line"> //如果properties是纯对象  </span><br><span class="line"> if (isPlainObject(properties)) &#123;  </span><br><span class="line"> nodes = $(dom) //转为zepto集合  </span><br><span class="line"> $.each(properties, function(key, value) &#123; //遍历properties  </span><br><span class="line"> //如果key在methodAttributes数组中  </span><br><span class="line"> if (methodAttributes.indexOf(key) &gt; -1) nodes[key](value) //$(selector).val(value)  </span><br><span class="line"> else nodes.attr(key, value) //使用attr方式设值  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> return dom  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.Z` swaps out the prototype of the given `dom` array  </span><br><span class="line"> // of nodes with `$.fn` and thus supplying all the Zepto functions  </span><br><span class="line"> // to the array. This method can be overridden in plugins.  </span><br><span class="line"> zepto.Z = function(dom, selector) &#123;  </span><br><span class="line"> //返回Z的实例  </span><br><span class="line"> return new Z(dom, selector)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.isZ` should return `true` if the given object is a Zepto  </span><br><span class="line"> // collection. This method can be overridden in plugins.  </span><br><span class="line"> //http://www.ibm.com/developerworks/cn/web/1306_jiangjj_jsinstanceof/  </span><br><span class="line"> zepto.isZ = function(object) &#123;  </span><br><span class="line"> //这里用zepto.Z而不是Z，大概是因为zepto.Z可以被重新吧  </span><br><span class="line"> //判断object是否是zepto.Z的实例,看它的原型链，是否是zepto.z.prototype  </span><br><span class="line"> //object.__proto__ === zepto.Z.prototype↘  </span><br><span class="line"> //object.__proto__.__proto__===zepto.Z.prototype  </span><br><span class="line"> return object instanceof zepto.Z  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.init` is Zepto&apos;s counterpart to jQuery&apos;s `$.fn.init` and  </span><br><span class="line"> // takes a CSS selector and an optional context (and handles various  </span><br><span class="line"> // special cases).  </span><br><span class="line"> // This method can be overridden in plugins.  </span><br><span class="line"> //如果是创建DOM或者数组包裹对象，selector为null  </span><br><span class="line"> zepto.init = function(selector, context) &#123;  </span><br><span class="line"> var dom  </span><br><span class="line"> // If nothing given, return an empty Zepto collection  </span><br><span class="line"> //如果选择器没有传，返回一个空的zepto实例  </span><br><span class="line"> if (!selector) return zepto.Z()  </span><br><span class="line"> // Optimize for string selectors  </span><br><span class="line"> else if (typeof selector == &apos;string&apos;) &#123; //如果选择器是字符串  </span><br><span class="line"> selector = selector.trim() //去两端空格  </span><br><span class="line"> // If it&apos;s a html fragment, create nodes from it  </span><br><span class="line"> // Note: In both Chrome 21 and Firefox 15, DOM error 12  </span><br><span class="line"> // is thrown if the fragment doesn&apos;t begin with &lt;  </span><br><span class="line"> if (selector[0] == &apos; &amp;&amp; fragmentRE.test(selector)) //如果字符串的第一个字符是  </span><br><span class="line"> dom = zepto.fragment(selector, RegExp.$1, context), selector = null //创建dom标签  </span><br><span class="line"> // If there&apos;s a context, create a collection on that context first, and select  </span><br><span class="line"> // nodes from there  </span><br><span class="line"> //如果有上下文，先创建一个zepto集合，在集合中找  </span><br><span class="line"> else if (context !== undefined) return $(context).find(selector)  </span><br><span class="line"> // If it&apos;s a CSS selector, use it to select nodes.  </span><br><span class="line"> //如果是选择器，使用zepto.qsa  </span><br><span class="line"> else dom = zepto.qsa(document, selector)  </span><br><span class="line"> &#125;  </span><br><span class="line"> // If a function is given, call it when the DOM is ready  </span><br><span class="line"> //如果选择器是函数，DOM ready后调用  </span><br><span class="line"> else if (isFunction(selector)) return $(document).ready(selector)  </span><br><span class="line"> // If a Zepto collection is given, just return it  </span><br><span class="line"> //如果selector是zepto.Z实例，直接返回selector  </span><br><span class="line"> else if (zepto.isZ(selector)) return selector  </span><br><span class="line"> else &#123;  </span><br><span class="line"> // normalize array if an array of nodes is given  </span><br><span class="line"> //如果selector是数组，过滤掉undefined和null  </span><br><span class="line"> if (isArray(selector)) dom = compact(selector)  </span><br><span class="line"> // Wrap DOM nodes.  </span><br><span class="line">  </span><br><span class="line"> else if (isObject(selector)) //如果是对象  </span><br><span class="line"> dom = [selector], selector = null //数组包裹对象  </span><br><span class="line"> // If it&apos;s a html fragment, create nodes from it  </span><br><span class="line"> else if (fragmentRE.test(selector)) //如果是html字符串，创建dom数组  </span><br><span class="line"> dom = zepto.fragment(selector.trim(), RegExp.$1, context), selector = null  </span><br><span class="line"> // If there&apos;s a context, create a collection on that context first, and select  </span><br><span class="line"> // nodes from there  </span><br><span class="line"> //如果上下文不为空，先创建一个集合，在集合中找  </span><br><span class="line"> else if (context !== undefined) return $(context).find(selector)  </span><br><span class="line"> // And last but no least, if it&apos;s a CSS selector, use it to select nodes.  </span><br><span class="line"> //否则返回zepto.qsa  </span><br><span class="line"> else dom = zepto.qsa(document, selector)  </span><br><span class="line"> &#125;  </span><br><span class="line"> // create a new Zepto collection from the nodes found  </span><br><span class="line"> //返回Z的实例  </span><br><span class="line"> return zepto.Z(dom, selector)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // `  </span><br><span class="line"> // function just call `$.zepto.init, which makes the implementation  </span><br><span class="line"> // details of selecting nodes and creating Zepto collections  </span><br><span class="line"> // patchable in plugins.  </span><br><span class="line">  </span><br><span class="line"> /*  </span><br><span class="line"> 继承  </span><br><span class="line"> */  </span><br><span class="line"> //返回zepto.init的调用结果  </span><br><span class="line"> $ = function(selector, context) &#123;  </span><br><span class="line"> return zepto.init(selector, context)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> function extend(target, source, deep) &#123;  </span><br><span class="line"> for (key in source)  </span><br><span class="line"> if (deep &amp;&amp; (isPlainObject(source[key]) || isArray(source[key]))) &#123; //如果是深拷贝且 对象中的属性是一个纯对象或数组（引用类型）  </span><br><span class="line"> if (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key])) //如果源对象的属性是纯对象且目标对象的属性不是纯对象  </span><br><span class="line"> target[key] = &#123;&#125; //目标对象的属性设为&#123;&#125;  </span><br><span class="line"> if (isArray(source[key]) &amp;&amp; !isArray(target[key])) //如果源对象属性是数组且目标对象的属性是数组  </span><br><span class="line"> target[key] = [] //目标对象的属性设为[]  </span><br><span class="line"> extend(target[key], source[key], deep) //调用extend  </span><br><span class="line"> &#125; else if (source[key] !== undefined) target[key] = source[key] //浅拷贝或者属性不是引用类型或者是宿主对象，如果属性值不为undefined  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // Copy all but undefined properties from one or more  </span><br><span class="line"> // objects to the `target` object.  </span><br><span class="line"> //绑定$的静态方法extend  </span><br><span class="line"> $.extend = function(target) &#123;  </span><br><span class="line"> var deep, args = slice.call(arguments, 1) //转为数组，args从arguments的第二个参数开始取  </span><br><span class="line"> if (typeof target == &apos;boolean&apos;) &#123; //如果target类型为bool  </span><br><span class="line"> deep = target //是否深拷贝  </span><br><span class="line"> target = args.shift() //数组的第一个值，shift删除会影响原数组  </span><br><span class="line"> &#125;  </span><br><span class="line"> //调用extend  </span><br><span class="line"> args.forEach(function(arg) &#123;  </span><br><span class="line"> extend(target, arg, deep)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return target  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> /*  </span><br><span class="line"> 选择器  </span><br><span class="line"> */  </span><br><span class="line">  </span><br><span class="line"> // `$.zepto.qsa` is Zepto&apos;s CSS selector implementation which  </span><br><span class="line"> // uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.  </span><br><span class="line"> // This method can be overridden in plugins.  </span><br><span class="line"> zepto.qsa = function(element, selector) &#123;  </span><br><span class="line"> var found,  </span><br><span class="line"> maybeID = selector[0] == &apos;#&apos;,//selector以#开头认为是id选择器  </span><br><span class="line"> maybeClass = !maybeID &amp;&amp; selector[0] == &apos;.&apos;,//类选择器  </span><br><span class="line"> //选取选择器的名字  </span><br><span class="line"> nameOnly = maybeID || maybeClass ? selector.slice(1) : selector, // Ensure that a 1 char tag name still gets checked  </span><br><span class="line"> //检测是否是简单选择器  </span><br><span class="line"> isSimple = simpleSelectorRE.test(nameOnly)  </span><br><span class="line"> //如果 1存在getElementById方法，2是简单选择器，3可能是id选择器  </span><br><span class="line"> return (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) ? // Safari DocumentFragment doesn&apos;t have getElementById  </span><br><span class="line"> //调用getElementById，结果作为数组返回  </span><br><span class="line"> ((found = element.getElementById(nameOnly)) ? [found] : []) :  </span><br><span class="line"> //如果不满足上面的123，这三个条件  </span><br><span class="line"> //如果满足4不为元素、5不为document，6不是文档碎片这三个条件，返回空数组  </span><br><span class="line"> (element.nodeType !== 1 &amp;&amp; element.nodeType !== 9 &amp;&amp; element.nodeType !== 11) ? [] :  </span><br><span class="line"> //元素或者document或者文档碎片  </span><br><span class="line"> //如果满足7是简单选择器，8不是id选择器，9getElementsByClassName方法存在这三个条件  </span><br><span class="line"> //=&gt;如果是类选择器，调用getElementsByClassName  </span><br><span class="line"> //=&gt;不是类选择器，就调用getElementsByTagName  </span><br><span class="line"> //不满足789的话，调用querySelectorAll  </span><br><span class="line"> //最后调用结果转为数组返回  </span><br><span class="line"> slice.call(  </span><br><span class="line"> isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ? // DocumentFragment doesn&apos;t have getElementsByClassName/TagName  </span><br><span class="line"> maybeClass ? element.getElementsByClassName(nameOnly) : // If it&apos;s simple, it could be a class  </span><br><span class="line"> element.getElementsByTagName(selector) : // Or a tag  </span><br><span class="line"> element.querySelectorAll(selector) // Or it&apos;s not simple, and we need to query all  </span><br><span class="line"> )  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //过滤  </span><br><span class="line"> function filtered(nodes, selector) &#123;  </span><br><span class="line"> //如果selector为null或者undefined，返回$(nodes)  </span><br><span class="line"> //否则返回$(nodes).filter(selector)  </span><br><span class="line"> return selector == null ? $(nodes) : $(nodes).filter(selector)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //静态方法$.contains  </span><br><span class="line"> //如果document.documentElement.contains方法的存在，  </span><br><span class="line"> $.contains = document.documentElement.contains ?  </span><br><span class="line"> //$.contains方法定义如下  </span><br><span class="line"> function(parent, node) &#123;  </span><br><span class="line"> //contains这个方法判断自身的包含关系时也返回true，所以首先用parent !== node排除掉  </span><br><span class="line"> return parent !== node &amp;&amp; parent.contains(node)  </span><br><span class="line"> &#125; ://如果不存在，则  </span><br><span class="line"> function(parent, node) &#123;  </span><br><span class="line"> //如果node存在，node赋值为其父节点  </span><br><span class="line"> while (node &amp;&amp; (node = node.parentNode))  </span><br><span class="line"> //判断node是否等于parent，如果是跳出循环，返回true  </span><br><span class="line"> if (node === parent) return true  </span><br><span class="line"> //如果否，继续判断。直到node已经没有父节点了，然后返回false  </span><br><span class="line"> return false  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> function funcArg(context, arg, idx, payload) &#123;  </span><br><span class="line"> //如果arg是方法，调用arg方法，且this指向context,idx和payload作为参数传入，然后返回调用结果  </span><br><span class="line"> //如果不是直接返回arg  </span><br><span class="line"> return isFunction(arg) ? arg.call(context, idx, payload) : arg  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> function setAttribute(node, name, value) &#123;  </span><br><span class="line"> //如果value为null或者undefined，元素移除属性  </span><br><span class="line"> //否则的话，元素设置属性  </span><br><span class="line"> //这里的坑点就是bool属性了  </span><br><span class="line"> value == null ? node.removeAttribute(name) : node.setAttribute(name, value)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // access className property while respecting SVGAnimatedString  </span><br><span class="line"> function className(node, value) &#123;  </span><br><span class="line"> var klass = node.className || &apos;&apos;,//className  </span><br><span class="line"> svg = klass &amp;&amp; klass.baseVal !== undefined//认为是svg  </span><br><span class="line">  </span><br><span class="line"> //如果value为undefined，如果是svg，返回className的baseVal，如果不是svg，直接返回className  </span><br><span class="line"> if (value === undefined) return svg ? klass.baseVal : klass  </span><br><span class="line"> //如果value不为undefined，如果是svg，设置其className的baseVal值，如果不是svg，设置其className值  </span><br><span class="line"> svg ? (klass.baseVal = value) : (node.className = value)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // &quot;true&quot;  =&gt; true  </span><br><span class="line"> // &quot;false&quot; =&gt; false  </span><br><span class="line"> // &quot;null&quot;  =&gt; null  </span><br><span class="line"> // &quot;42&quot;    =&gt; 42  </span><br><span class="line"> // &quot;42.5&quot;  =&gt; 42.5  </span><br><span class="line"> // &quot;08&quot;    =&gt; &quot;08&quot;  </span><br><span class="line"> // JSON    =&gt; parse if valid  </span><br><span class="line"> // String  =&gt; self  </span><br><span class="line">  </span><br><span class="line"> //跟toString方法相反  </span><br><span class="line"> function deserializeValue(value) &#123;  </span><br><span class="line"> //+value + &quot;&quot; == value 貌似适用于数字，布尔和字符串简单类型  </span><br><span class="line"> try &#123;  </span><br><span class="line"> return value ?//如果value为真值  </span><br><span class="line"> value == &quot;true&quot; ||//如果value是字符串true,就返回true  </span><br><span class="line"> //如果value不是字符串true的话...  </span><br><span class="line"> (value == &quot;false&quot; ? false ://value为&quot;false&quot;就返回false  </span><br><span class="line"> value == &quot;null&quot; ? null ://value为&quot;null&quot;就返回null  </span><br><span class="line"> +value + &quot;&quot; == value ? +value ://value为数字或者字符串  </span><br><span class="line"> /^[\[\&#123;]/.test(value) ? $.parseJSON(value) ://如果是数组字符串或者json字符串，调用$.parseJSON方法解析，否则就返回value  </span><br><span class="line"> value) : value//如果value为假值就直接返回  </span><br><span class="line"> &#125; catch (e) &#123;  </span><br><span class="line"> return value  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //静态方法，工具方法  </span><br><span class="line"> $.type = type，  </span><br><span class="line"> $.isFunction = isFunction  </span><br><span class="line"> $.isWindow = isWindow  </span><br><span class="line"> $.isArray = isArray  </span><br><span class="line"> $.isPlainObject = isPlainObject  </span><br><span class="line">  </span><br><span class="line"> //是否是空对象  </span><br><span class="line"> $.isEmptyObject = function(obj) &#123;  </span><br><span class="line"> var name  </span><br><span class="line"> for (name in obj) return false//如果对象有属性，返回假  </span><br><span class="line"> return true  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //判断某一个元素是否在数组中  </span><br><span class="line"> $.inArray = function(elem, array, i) &#123;  </span><br><span class="line"> return emptyArray.indexOf.call(array, elem, i)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> $.camelCase = camelize//驼峰  </span><br><span class="line"> //去除两头空格  </span><br><span class="line"> $.trim = function(str) &#123;  </span><br><span class="line"> //如果str为null或者undefined，直接返回&apos;&apos;  </span><br><span class="line"> //竟然能将数组转为字符串然后去空格  </span><br><span class="line"> return str == null ? &quot;&quot; : String.prototype.trim.call(str)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // plugin compatibility  </span><br><span class="line"> $.uuid = 0 //唯一标识码，目前还看不出是什么用处  </span><br><span class="line"> $.support = &#123;&#125; //貌似是为了做兼容  </span><br><span class="line"> $.expr = &#123;&#125; //不知道是什么鬼  </span><br><span class="line"> $.noop = function() &#123;&#125; //空函数  </span><br><span class="line">  </span><br><span class="line"> $.map = function(elements, callback) &#123;  </span><br><span class="line"> var value, values = [],  </span><br><span class="line"> i, key  </span><br><span class="line"> if (likeArray(elements))//如果是类数组for循环调用，不是类数组for in调用  </span><br><span class="line"> for (i = 0; i &lt; elements.length; i++) &#123;  </span><br><span class="line"> value = callback(elements[i], i)//遍历调用callback  </span><br><span class="line"> //如果value不为null或者undefined，将value推入values数组中  </span><br><span class="line"> if (value != null) values.push(value)  </span><br><span class="line"> &#125;   </span><br><span class="line"> else //如果不是类数组  </span><br><span class="line"> for (key in elements) &#123;  </span><br><span class="line"> value = callback(elements[key], key)  </span><br><span class="line"> if (value != null) values.push(value)  </span><br><span class="line"> &#125;  </span><br><span class="line"> return flatten(values)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> $.each = function(elements, callback) &#123;  </span><br><span class="line"> var i, key  </span><br><span class="line"> if (likeArray(elements)) &#123;//这里也同map一样区分了是否类数组  </span><br><span class="line"> for (i = 0; i &lt; elements.length; i++)  </span><br><span class="line"> //如果调用===false 中断遍历返回，必须是false才会中断  </span><br><span class="line"> if (callback.call(elements[i], i, elements[i]) === false) return elements  </span><br><span class="line"> &#125; else &#123;  </span><br><span class="line"> for (key in elements)  </span><br><span class="line"> if (callback.call(elements[key], key, elements[key]) === false) return elements  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> return elements  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //过滤数组，返回过滤结果  </span><br><span class="line"> $.grep = function(elements, callback) &#123;  </span><br><span class="line"> return filter.call(elements, callback)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> if (window.JSON) $.parseJSON = JSON.parse  </span><br><span class="line">  </span><br><span class="line"> //遍历设置class2type对象的属性  </span><br><span class="line"> // Populate the class2type map  </span><br><span class="line"> $.each(&quot;Boolean Number String Function Array Date RegExp Object Error&quot;.split(&quot; &quot;), function(i, name) &#123;  </span><br><span class="line"> class2type[&quot;[object &quot; + name + &quot;]&quot;] = name.toLowerCase()  </span><br><span class="line"> &#125;)  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"> // Define methods that will be available on all  </span><br><span class="line"> // Zepto collections  </span><br><span class="line"> $.fn = &#123;  </span><br><span class="line"> constructor: zepto.Z,//设置构造器为zepto.Z  </span><br><span class="line"> length: 0,//长度，不知道有什么用  </span><br><span class="line">  </span><br><span class="line"> // Because a collection acts like an array  </span><br><span class="line"> // copy over these useful array functions.  </span><br><span class="line"> forEach: emptyArray.forEach,//数组原生方法  </span><br><span class="line"> reduce: emptyArray.reduce,  </span><br><span class="line"> push: emptyArray.push,  </span><br><span class="line"> sort: emptyArray.sort,  </span><br><span class="line"> splice: emptyArray.splice,  </span><br><span class="line"> indexOf: emptyArray.indexOf,  </span><br><span class="line"> //连接数组，它不会改变原有数组，返回的是一个新的数组  </span><br><span class="line"> concat: function() &#123;  </span><br><span class="line"> var i, value, args = []  </span><br><span class="line"> for (i = 0; i &lt; arguments.length; i++) &#123;  </span><br><span class="line"> value = arguments[i]//遍历arguments  </span><br><span class="line"> //如果当前参数value是zepto.Z的实例，args[i]是转为数组的value,  </span><br><span class="line"> //如果不是zepto.Z的实例,args[i]为value  </span><br><span class="line"> args[i] = zepto.isZ(value) ? value.toArray() : value  </span><br><span class="line"> &#125;  </span><br><span class="line"> //调用concat方法，如果this是zepto.z的实例，this指向转为数组后的this  </span><br><span class="line"> return concat.apply(zepto.isZ(this) ? this.toArray() : this, args)  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> // `map` and `slice` in the jQuery API work differently  </span><br><span class="line"> // from their array counterparts  </span><br><span class="line"> map: function(fn) &#123;  </span><br><span class="line"> //遍历this，调用$.map,返回的结果转为zepto.Z的实例  </span><br><span class="line"> return $($.map(this, function(el, i) &#123;  </span><br><span class="line"> return fn.call(el, i, el)  </span><br><span class="line"> &#125;))  </span><br><span class="line"> &#125;,  </span><br><span class="line"> slice: function() &#123;  </span><br><span class="line"> //调用slice，返回的结果转为zepto.Z的实例  </span><br><span class="line"> return $(slice.apply(this, arguments))  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> ready: function(callback) &#123;  </span><br><span class="line"> // need to check if document.body exists for IE as that browser reports  </span><br><span class="line"> // document ready when it hasn&apos;t yet created the body element  </span><br><span class="line"> //如果readyState的状态为complete|loaded|interactive，并且document.body存在，调用回调  </span><br><span class="line"> if (readyRE.test(document.readyState) &amp;&amp; document.body) callback($)  </span><br><span class="line"> //否则，添加DOMContentLoaded事件绑定  </span><br><span class="line"> else document.addEventListener(&apos;DOMContentLoaded&apos;, function() &#123;  </span><br><span class="line"> callback($)  </span><br><span class="line"> &#125;, false)  </span><br><span class="line"> return this  </span><br><span class="line"> &#125;,  </span><br><span class="line"> get: function(idx) &#123;  </span><br><span class="line"> //如果idx为undefined，返回slice.call(this)，转为数组的  </span><br><span class="line"> //如果不为undefined，这时返回不是数组而是dom元素  </span><br><span class="line"> //=&gt;如果idx大于等于0，返回this[idx]  </span><br><span class="line"> //=&gt;否则返回this[idx + this.length]，即倒数第x个  </span><br><span class="line"> return idx === undefined ? slice.call(this) : this[idx &gt;= 0 ? idx : idx + this.length]  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //将this转为数组  </span><br><span class="line"> toArray: function() &#123;  </span><br><span class="line"> return this.get()  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //获取length属性  </span><br><span class="line"> size: function() &#123;  </span><br><span class="line"> return this.length  </span><br><span class="line"> &#125;,  </span><br><span class="line"> remove: function() &#123;  </span><br><span class="line">  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> //先判断是否有父节点，如果有就可移除this  </span><br><span class="line"> if (this.parentNode != null)  </span><br><span class="line"> this.parentNode.removeChild(this)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> each: function(callback) &#123;  </span><br><span class="line"> //调用数组的every方法，坑点，$().each方法回调中使用return false无效  </span><br><span class="line"> //所以还是使用$.each吧  </span><br><span class="line"> emptyArray.every.call(this, function(el, idx) &#123;  </span><br><span class="line"> return callback.call(el, idx, el) !== false  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return this  </span><br><span class="line"> &#125;,  </span><br><span class="line"> filter: function(selector) &#123;  </span><br><span class="line"> //如果selector是函数  </span><br><span class="line"> if (isFunction(selector)) return this.not(this.not(selector))  </span><br><span class="line"> //调用filter方法，过滤出匹配的元素，返回结果转为zepto.Z的实例  </span><br><span class="line"> return $(filter.call(this, function(element) &#123;  </span><br><span class="line"> //如果元素匹配选择器，返回true  </span><br><span class="line"> return zepto.matches(element, selector)  </span><br><span class="line"> &#125;))  </span><br><span class="line"> &#125;,  </span><br><span class="line"> add: function(selector, context) &#123;  </span><br><span class="line"> //首先$(selector, context)生成了一个zepto.Z的实例  </span><br><span class="line"> //调用this.concat方法合并后，转为了数组  </span><br><span class="line"> //经过数组去重，最后又转为zepto.Z的实例  </span><br><span class="line"> return $(uniq(this.concat($(selector, context))))  </span><br><span class="line"> &#125;,  </span><br><span class="line"> is: function(selector) &#123;  </span><br><span class="line"> //length&gt;0且判断this的第一个元素是否匹配选择器  </span><br><span class="line"> return this.length &gt; 0 &amp;&amp; zepto.matches(this[0], selector)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> not: function(selector) &#123;  </span><br><span class="line"> var nodes = []  </span><br><span class="line"> //如果selector是函数，并且selector.call存在  </span><br><span class="line"> if (isFunction(selector) &amp;&amp; selector.call !== undefined)  </span><br><span class="line"> //遍历this  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> //调用selector，修改this指向，如果返回结果为假值，push到nodes数组中  </span><br><span class="line"> if (!selector.call(this, idx)) nodes.push(this)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> else &#123;//否则的话，判断selector是否是字符串，如果是字符串，excludes=调用this.filter结果  </span><br><span class="line"> var excludes = typeof selector == &apos;string&apos; ? this.filter(selector) :  </span><br><span class="line"> //如果不是字符串，判断它是否是类数组，  </span><br><span class="line"> //且是否有item（HTMLCollection、NodeList、NamedNodeMap这三个都有item方法）  </span><br><span class="line"> //如果为真，excludes=转为数组selector  </span><br><span class="line"> //如果为假，selector=selector转为zepto.Z的实例  </span><br><span class="line"> (likeArray(selector) &amp;&amp; isFunction(selector.item)) ? slice.call(selector) : $(selector)  </span><br><span class="line"> //如果不在excludes数组后，push进去  </span><br><span class="line"> this.forEach(function(el) &#123;  </span><br><span class="line"> if (excludes.indexOf(el) &lt; 0) nodes.push(el)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line"> //转为zepto.Z的实例后返回  </span><br><span class="line"> return $(nodes)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> has: function(selector) &#123;  </span><br><span class="line"> //调用this.filter，返回过滤后的结果  </span><br><span class="line"> return this.filter(function() &#123;  </span><br><span class="line"> //内部的过滤方案是首先判断selector是否是一个对象  </span><br><span class="line"> //如果是对象，判断是否包含，包含返回true  </span><br><span class="line"> //如果不是对象，将this转为zepto.Z的实例，调用find方法，返回结果集合的length  </span><br><span class="line"> return isObject(selector) ?  </span><br><span class="line"> $.contains(this, selector) :  </span><br><span class="line"> $(this).find(selector).size()  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> eq: function(idx) &#123;  </span><br><span class="line"> //如果idx为-1，返回this.slice(idx)  </span><br><span class="line"> //否则返回this.slice(idx, +idx + 1)  </span><br><span class="line"> return idx === -1 ? this.slice(idx) : this.slice(idx, +idx + 1)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> first: function() &#123;  </span><br><span class="line"> var el = this[0]  </span><br><span class="line"> //el为真值且el不是对象的话，返回el  </span><br><span class="line"> //否则返回$(el)  </span><br><span class="line"> //=&gt;假值返回的是[]，对象是转为zepto.Z的实例后返回  </span><br><span class="line"> return el &amp;&amp; !isObject(el) ? el : $(el)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> last: function() &#123;  </span><br><span class="line"> //el是最后一个元素，其他逻辑同first  </span><br><span class="line"> var el = this[this.length - 1]  </span><br><span class="line"> return el &amp;&amp; !isObject(el) ? el : $(el)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> find: function(selector) &#123;  </span><br><span class="line"> var result, $this = this  </span><br><span class="line"> //选择器不存在，返回空的zepto.Z实例  </span><br><span class="line"> if (!selector) result = $()  </span><br><span class="line"> else if (typeof selector == &apos;object&apos;)//如果typeof结果是对象  </span><br><span class="line"> //filter过滤，将其转为zepto.Z实例  </span><br><span class="line"> result = $(selector).filter(function() &#123;  </span><br><span class="line"> var node = this  </span><br><span class="line"> //some用于检测数组是否满足条件，只要有一个满足则返回true  </span><br><span class="line"> //这里检测是否包含子元素  </span><br><span class="line"> return emptyArray.some.call($this, function(parent) &#123;  </span><br><span class="line"> return $.contains(parent, node)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> //selector不为对象或数组且this.length为1，直接使用zepto.qsa然后转为zepto.Z实例  </span><br><span class="line"> else if (this.length == 1) result = $(zepto.qsa(this[0], selector))  </span><br><span class="line"> //selector不为对象或数组且this.length不为1  </span><br><span class="line"> else result = this.map(function() &#123;  </span><br><span class="line"> return zepto.qsa(this, selector)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return result  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //从元素本身开始，逐级向上级元素匹配，并返回最先匹配selector的元素。如果给定context节点参数，那么只匹配该节点的后代元素。  </span><br><span class="line"> closest: function(selector, context) &#123;  </span><br><span class="line"> var node = this[0],//获取this第一个元素  </span><br><span class="line"> collection = false //不是html集合？  </span><br><span class="line"> //如果selector是对象类型，将selector转为zepto.Z的实例后赋给collection  </span><br><span class="line"> if (typeof selector == &apos;object&apos;) collection = $(selector)  </span><br><span class="line"> //this的第一个元素存在  </span><br><span class="line"> //且第二个表达式为假  </span><br><span class="line"> //collection ? collection.indexOf(node) &gt;= 0 : zepto.matches(node, selector)  </span><br><span class="line"> //=&gt;collection为真则判断collection中是否能找到node  </span><br><span class="line"> //=&gt;为假则（selector不是对象，可能是字符串选择器之类的）调用 zepto.matches  </span><br><span class="line"> while (node &amp;&amp; !(collection ? collection.indexOf(node) &gt;= 0 : zepto.matches(node, selector)))  </span><br><span class="line"> //1、判断不为本身，比如$(&apos;window&apos;)[0]===window  </span><br><span class="line"> //2、判断不为document  </span><br><span class="line"> //3、返回其父节点  </span><br><span class="line"> node = node !== context &amp;&amp; !isDocument(node) &amp;&amp; node.parentNode  </span><br><span class="line"> return $(node)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> parents: function(selector) &#123;  </span><br><span class="line"> var ancestors = [],//祖先  </span><br><span class="line"> nodes = this  </span><br><span class="line"> while (nodes.length &gt; 0)  </span><br><span class="line"> //遍历this  </span><br><span class="line"> nodes = $.map(nodes, function(node) &#123;  </span><br><span class="line"> //node.parentNode赋值给node、判断是否存在  </span><br><span class="line"> //判断node是不是document  </span><br><span class="line"> //判断node还没有存入祖先元素数组中  </span><br><span class="line"> if ((node = node.parentNode) &amp;&amp; !isDocument(node) &amp;&amp; ancestors.indexOf(node) &lt; 0) &#123;  </span><br><span class="line"> //添加到祖先元素数组  </span><br><span class="line"> ancestors.push(node)  </span><br><span class="line"> return node  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return filtered(ancestors, selector)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> parent: function(selector) &#123;  </span><br><span class="line"> //遍历获取this的parentNode属性值，去重后返回filtered的调用结果  </span><br><span class="line"> return filtered(uniq(this.pluck(&apos;parentNode&apos;)), selector)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> children: function(selector) &#123;  </span><br><span class="line"> //遍历调用,this.map内部做了数组扁平化  </span><br><span class="line"> return filtered(this.map(function() &#123;  </span><br><span class="line"> return children(this)  </span><br><span class="line"> &#125;), selector)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> contents: function() &#123;  </span><br><span class="line"> return this.map(function() &#123;  </span><br><span class="line"> //contentDocument哪里冒出来的。。。  </span><br><span class="line"> //childNodes包含文本节点与注释  </span><br><span class="line"> return this.contentDocument || slice.call(this.childNodes)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> siblings: function(selector) &#123;  </span><br><span class="line"> //父元素的children过滤掉自身  </span><br><span class="line"> return filtered(this.map(function(i, el) &#123;  </span><br><span class="line"> return filter.call(children(el.parentNode), function(child) &#123;  </span><br><span class="line"> return child !== el  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;), selector)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> empty: function() &#123;  </span><br><span class="line"> //遍历修改自身的innerHTML  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> this.innerHTML = &apos;&apos;  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //遍历获取属性值  </span><br><span class="line"> //$(&apos;.item&apos;).pluck(&apos;title&apos;)  </span><br><span class="line"> //=&gt;[&quot;多件多折&quot;, &quot;Top榜&quot;, &quot;全球购&quot;, &quot;下期预告&quot;, &quot;更多分类&quot;, &quot;纸尿裤&quot;, &quot;奶粉&quot;, &quot;非常大牌&quot;, &quot;五羊&quot;]  </span><br><span class="line"> // `pluck` is borrowed from Prototype.js  </span><br><span class="line"> pluck: function(property) &#123;  </span><br><span class="line"> return $.map(this, function(el) &#123;  </span><br><span class="line"> return el[property]  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> show: function() &#123;  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> //如果display为none，display改为&apos;&apos;  </span><br><span class="line"> //我的理解是清除行内样式  </span><br><span class="line"> //http://stackoverflow.com/questions/7420109/what-does-style-display-actually-do  </span><br><span class="line"> this.style.display == &quot;none&quot; &amp;&amp; (this.style.display = &apos;&apos;)  </span><br><span class="line"> //如果this的计算样式为none，赋值为其默认的display值  </span><br><span class="line"> //清除行内样式后，仍有可能样式表中也设了css，所以如果没效，还是要去设置一下默认值  </span><br><span class="line"> if (getComputedStyle(this, &apos;&apos;).getPropertyValue(&quot;display&quot;) == &quot;none&quot;)  </span><br><span class="line"> this.style.display = defaultDisplay(this.nodeName)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> replaceWith: function(newContent) &#123;  </span><br><span class="line"> return this.before(newContent).remove()  </span><br><span class="line"> &#125;,  </span><br><span class="line"> wrap: function(structure) &#123;  </span><br><span class="line"> var func = isFunction(structure)//判断structure是否是函数  </span><br><span class="line"> if (this[0] &amp;&amp; !func)//如果不为函数  </span><br><span class="line"> var dom = $(structure).get(0),  </span><br><span class="line"> clone = dom.parentNode || this.length &gt; 1//structure有父元素或者this集合中有多个元素  </span><br><span class="line">  </span><br><span class="line"> return this.each(function(index) &#123;  </span><br><span class="line"> $(this).wrapAll(  </span><br><span class="line"> func ? structure.call(this, index) :  </span><br><span class="line"> clone ? dom.cloneNode(true) : dom  </span><br><span class="line"> )  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //包裹外层  </span><br><span class="line"> wrapAll: function(structure) &#123;  </span><br><span class="line"> if (this[0]) &#123;  </span><br><span class="line"> $(this[0]).before(structure = $(structure))  </span><br><span class="line"> var children  </span><br><span class="line"> while ((children = structure.children()).length) structure = children.first()  </span><br><span class="line"> $(structure).append(this)  </span><br><span class="line"> &#125;  </span><br><span class="line"> return this  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //内容包裹  </span><br><span class="line"> wrapInner: function(structure) &#123;  </span><br><span class="line"> var func = isFunction(structure)//判断是否是函数  </span><br><span class="line"> return this.each(function(index) &#123;  </span><br><span class="line"> var self = $(this),  </span><br><span class="line"> contents = self.contents(),//获取内容  </span><br><span class="line"> //如果是函数，dom=structure的调用结果，否则dom=structure  </span><br><span class="line"> dom = func ? structure.call(this, index) : structure  </span><br><span class="line"> //内容存在，调用contents.wrapAll ，否则调用append  </span><br><span class="line"> contents.length ? contents.wrapAll(dom) : self.append(dom)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> unwrap: function() &#123;  </span><br><span class="line"> this.parent().each(function() &#123;  </span><br><span class="line"> //子元素替换自身  </span><br><span class="line"> $(this).replaceWith($(this).children())  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return this  </span><br><span class="line"> &#125;,  </span><br><span class="line"> clone: function() &#123;  </span><br><span class="line"> return this.map(function() &#123;  </span><br><span class="line"> return this.cloneNode(true)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> hide: function() &#123;  </span><br><span class="line"> return this.css(&quot;display&quot;, &quot;none&quot;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> toggle: function(setting) &#123;  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> var el = $(this);  </span><br><span class="line"> //setting为undefined时，判断元素的display是否为none,否则判断setting真假  </span><br><span class="line"> (setting === undefined ? el.css(&quot;display&quot;) == &quot;none&quot; : setting) ? el.show() : el.hide()  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> prev: function(selector) &#123;  </span><br><span class="line"> return $(this.pluck(&apos;previousElementSibling&apos;)).filter(selector || &apos;*&apos;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> next: function(selector) &#123;  </span><br><span class="line"> return $(this.pluck(&apos;nextElementSibling&apos;)).filter(selector || &apos;*&apos;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> html: function(html) &#123;  </span><br><span class="line"> //html如果存在  </span><br><span class="line"> return 0 in arguments ?  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> var originHtml = this.innerHTML//暂存innerHTML  </span><br><span class="line"> //funcArg用于处理参数是函数的情况  </span><br><span class="line"> $(this).empty().append(funcArg(this, html, idx, originHtml))  </span><br><span class="line"> &#125;) :  </span><br><span class="line"> //html如不存在，取值  </span><br><span class="line"> (0 in this ? this[0].innerHTML : null)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> text: function(text) &#123;  </span><br><span class="line"> return 0 in arguments ?  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> var newText = funcArg(this, text, idx, this.textContent)  </span><br><span class="line"> //如果为null转为&apos;&apos;  </span><br><span class="line"> this.textContent = newText == null ? &apos;&apos; : &apos;&apos; + newText  </span><br><span class="line"> &#125;) :  </span><br><span class="line"> //获取所有子元素的textContent属性值，用空字符串拼接  </span><br><span class="line"> //textContent的兼容性是ie8及以下不支持  </span><br><span class="line"> (0 in this ? this.pluck(&apos;textContent&apos;).join(&quot;&quot;) : null)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> attr: function(name, value) &#123;  </span><br><span class="line"> var result  </span><br><span class="line"> //如果name是字符串类型 且value不存在，取值  </span><br><span class="line"> //=&gt;this.length不存在或者this不是element元素，返回undefined  </span><br><span class="line"> //=&gt;存在则获取this第一个元素的name属性this[0].getAttribute(name)，赋值给result，判断result是否为真值，再判断this的第一个元素是否有name属性name in this[0]  </span><br><span class="line"> //如果getAttribute方式取不到值，但name in ...为真，则返回this[0][name]  </span><br><span class="line"> //否则返回result  </span><br><span class="line"> //这里可以区分下属性、特性的区别。。。  </span><br><span class="line"> return (typeof name == &apos;string&apos; &amp;&amp; !(1 in arguments)) ?  </span><br><span class="line"> (!this.length || this[0].nodeType !== 1 ? undefined :  </span><br><span class="line"> (!(result = this[0].getAttribute(name)) &amp;&amp; name in this[0]) ? this[0][name] : result  </span><br><span class="line"> ) :  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> //如果不是元素节点，返回  </span><br><span class="line"> if (this.nodeType !== 1) return  </span><br><span class="line"> //如果是对象，遍历设值   </span><br><span class="line"> if (isObject(name))  </span><br><span class="line"> for (key in name) setAttribute(this, key, name[key])  </span><br><span class="line"> //单个设值，要考虑可能value是函数的情景  </span><br><span class="line"> else setAttribute(this, name, funcArg(this, value, idx, this.getAttribute(name)))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> removeAttr: function(name) &#123;  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> //节点类型是元素  </span><br><span class="line"> //多个attr可以用空格分隔  </span><br><span class="line"> this.nodeType === 1 &amp;&amp; name.split(&apos; &apos;).forEach(function(attribute) &#123;  </span><br><span class="line"> //第三个参数未填则为移除属性  </span><br><span class="line"> setAttribute(this, attribute)  </span><br><span class="line"> &#125;, this)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> prop: function(name, value) &#123;  </span><br><span class="line"> name = propMap[name] || name//首先判断propMap中是否存在  </span><br><span class="line"> return (1 in arguments) ?//设值  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> this[name] = funcArg(this, value, idx, this[name])  </span><br><span class="line"> &#125;) ://取值  </span><br><span class="line"> (this[0] &amp;&amp; this[0][name])  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //内部竟然调用的是attr,只不过在最后做了下数据类型转换  </span><br><span class="line"> data: function(name, value) &#123;  </span><br><span class="line"> var attrName = &apos;data-&apos; + name.replace(capitalRE, &apos;-$1&apos;).toLowerCase()  </span><br><span class="line">  </span><br><span class="line"> var data = (1 in arguments) ?  </span><br><span class="line"> this.attr(attrName, value) :  </span><br><span class="line"> this.attr(attrName)  </span><br><span class="line"> //如果不为null，返回deserializeValue(data)，否则返回undefined  </span><br><span class="line"> return data !== null ? deserializeValue(data) : undefined  </span><br><span class="line"> &#125;,  </span><br><span class="line"> val: function(value) &#123;  </span><br><span class="line"> //设值  </span><br><span class="line"> return 0 in arguments ?  </span><br><span class="line"> this.each(function(idx) &#123;  </span><br><span class="line"> this.value = funcArg(this, value, idx, this.value)  </span><br><span class="line"> &#125;) :  </span><br><span class="line"> //取值  </span><br><span class="line"> //如果存在multiple属性，获取所有option下面的value值  </span><br><span class="line"> (this[0] &amp;&amp; (this[0].multiple ?  </span><br><span class="line"> $(this[0]).find(&apos;option&apos;).filter(function() &#123;  </span><br><span class="line"> return this.selected  </span><br><span class="line"> &#125;).pluck(&apos;value&apos;) :  </span><br><span class="line"> this[0].value))//否则取第一个元素的值  </span><br><span class="line"> &#125; ,  </span><br><span class="line"> offset: function(coordinates) &#123;  </span><br><span class="line"> //设值，目标值减去获取最近非静态定位祖先元素的offset值  </span><br><span class="line"> //然后设置css  </span><br><span class="line"> if (coordinates) return this.each(function(index) &#123;  </span><br><span class="line"> var $this = $(this),  </span><br><span class="line"> coords = funcArg(this, coordinates, index, $this.offset()),  </span><br><span class="line"> parentOffset = $this.offsetParent().offset(),  </span><br><span class="line"> props = &#123;  </span><br><span class="line"> top: coords.top - parentOffset.top,  </span><br><span class="line"> left: coords.left - parentOffset.left  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> if ($this.css(&apos;position&apos;) == &apos;static&apos;) props[&apos;position&apos;] = &apos;relative&apos;  </span><br><span class="line"> $this.css(props)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> //如果this为空集合，返回null  </span><br><span class="line"> if (!this.length) return null  </span><br><span class="line"> //如果document.documentElement不包含this，iframe??  </span><br><span class="line"> if (!$.contains(document.documentElement, this[0]))  </span><br><span class="line"> return &#123;  </span><br><span class="line"> top: 0,  </span><br><span class="line"> left: 0  </span><br><span class="line"> &#125;  </span><br><span class="line"> //返回一个矩形对象，包含四个属性：left、top、right和bottom。分别表示元素各边与页面上边和左边的距离。  </span><br><span class="line"> var obj = this[0].getBoundingClientRect()  </span><br><span class="line"> return &#123;  </span><br><span class="line"> left: obj.left + window.pageXOffset,  </span><br><span class="line"> top: obj.top + window.pageYOffset,  </span><br><span class="line"> width: Math.round(obj.width),  </span><br><span class="line"> height: Math.round(obj.height)  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;,  </span><br><span class="line"> css: function(property, value) &#123;  </span><br><span class="line"> //取值  </span><br><span class="line"> if (arguments.length &lt; 2) &#123;  </span><br><span class="line"> var computedStyle, element = this[0]//第一个元素  </span><br><span class="line"> if (!element) return  </span><br><span class="line"> computedStyle = getComputedStyle(element, &apos;&apos;)  </span><br><span class="line"> if (typeof property == &apos;string&apos;)//如果是字符串  </span><br><span class="line"> //首先获取行内样式，如果为假值再去获取计算后的样式  </span><br><span class="line"> return element.style[camelize(property)] || computedStyle.getPropertyValue(property)  </span><br><span class="line"> else if (isArray(property)) &#123;//如果是数组，返回对象  </span><br><span class="line"> var props = &#123;&#125;  </span><br><span class="line"> $.each(property, function(_, prop) &#123;  </span><br><span class="line"> props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> return props  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> var css = &apos;&apos;  </span><br><span class="line"> if (type(property) == &apos;string&apos;) &#123;//如果是字符串  </span><br><span class="line"> if (!value &amp;&amp; value !== 0)//value为假值且不为0，认为是移除属性  </span><br><span class="line"> this.each(function() &#123;  </span><br><span class="line"> this.style.removeProperty(dasherize(property))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> else//添加css  </span><br><span class="line"> css = dasherize(property) + &quot;:&quot; + maybeAddPx(property, value)  </span><br><span class="line"> &#125; else &#123;  </span><br><span class="line"> for (key in property)  </span><br><span class="line"> if (!property[key] &amp;&amp; property[key] !== 0)  </span><br><span class="line"> this.each(function() &#123;  </span><br><span class="line"> this.style.removeProperty(dasherize(key))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> else  </span><br><span class="line"> css += dasherize(key) + &apos;:&apos; + maybeAddPx(key, property[key]) + &apos;;&apos;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> return this.each(function() &#123;  </span><br><span class="line"> this.style.cssText += &apos;;&apos; + css  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> index: function(element) &#123;  </span><br><span class="line"> //如果element存在，返回element第一个元素在this中的index  </span><br><span class="line"> //如果不存在，返回this在其父元素中的index  </span><br><span class="line"> return element ? this.indexOf($(element)[0]) : this.parent().children().indexOf(this[0])  </span><br><span class="line"> &#125;,  </span><br><span class="line"> hasClass: function(name) &#123;  </span><br><span class="line"> if (!name) return false  </span><br><span class="line"> return emptyArray.some.call(this, function(el) &#123;  </span><br><span class="line"> return this.test(className(el))  </span><br><span class="line"> &#125;, classRE(name))  </span><br><span class="line"> &#125;,  </span><br><span class="line"> addClass: function(name) &#123;  </span><br><span class="line"> if (!name) return this  </span><br><span class="line"> return this.each(function(idx) &#123;  </span><br><span class="line"> if (!(&apos;className&apos; in this)) return  </span><br><span class="line"> classList = []  </span><br><span class="line"> var cls = className(this),  </span><br><span class="line"> newName = funcArg(this, name, idx, cls)  </span><br><span class="line"> newName.split(/\s+/g).forEach(function(klass) &#123;  </span><br><span class="line"> if (!$(this).hasClass(klass)) classList.push(klass)  </span><br><span class="line"> &#125;, this)  </span><br><span class="line"> classList.length &amp;&amp; className(this, cls + (cls ? &quot; &quot; : &quot;&quot;) + classList.join(&quot; &quot;))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> removeClass: function(name) &#123;  </span><br><span class="line"> return this.each(function(idx) &#123;  </span><br><span class="line"> if (!(&apos;className&apos; in this)) return  </span><br><span class="line"> if (name === undefined) return className(this, &apos;&apos;)  </span><br><span class="line"> classList = className(this)  </span><br><span class="line"> funcArg(this, name, idx, classList).split(/\s+/g).forEach(function(klass) &#123;  </span><br><span class="line"> classList = classList.replace(classRE(klass), &quot; &quot;)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> className(this, classList.trim())  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> toggleClass: function(name, when) &#123;  </span><br><span class="line"> if (!name) return this  </span><br><span class="line"> return this.each(function(idx) &#123;  </span><br><span class="line"> var $this = $(this),  </span><br><span class="line"> names = funcArg(this, name, idx, className(this))  </span><br><span class="line"> names.split(/\s+/g).forEach(function(klass) &#123;  </span><br><span class="line"> (when === undefined ? !$this.hasClass(klass) : when) ?  </span><br><span class="line"> $this.addClass(klass) : $this.removeClass(klass)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> scrollTop: function(value) &#123;  </span><br><span class="line"> if (!this.length) return  </span><br><span class="line"> //如果第一个元素有scrollTop属性，hasScrollTop为true  </span><br><span class="line"> var hasScrollTop = &apos;scrollTop&apos; in this[0]  </span><br><span class="line"> //如果value未定义，判断hasScrollTop的值，为真返回scrollTop，否者返回pageYOffset  </span><br><span class="line"> if (value === undefined) return hasScrollTop ? this[0].scrollTop : this[0].pageYOffset  </span><br><span class="line"> return this.each(hasScrollTop ?  </span><br><span class="line"> function() &#123;  </span><br><span class="line"> this.scrollTop = value  </span><br><span class="line"> &#125; :  </span><br><span class="line"> function() &#123;  </span><br><span class="line"> this.scrollTo(this.scrollX, value)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> scrollLeft: function(value) &#123;  </span><br><span class="line"> if (!this.length) return  </span><br><span class="line"> var hasScrollLeft = &apos;scrollLeft&apos; in this[0]  </span><br><span class="line"> if (value === undefined) return hasScrollLeft ? this[0].scrollLeft : this[0].pageXOffset  </span><br><span class="line"> return this.each(hasScrollLeft ?  </span><br><span class="line"> function() &#123;  </span><br><span class="line"> this.scrollLeft = value  </span><br><span class="line"> &#125; :  </span><br><span class="line"> function() &#123;  </span><br><span class="line"> this.scrollTo(value, this.scrollY)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //获取对象集合中第一个元素的位置，  </span><br><span class="line"> position: function() &#123;  </span><br><span class="line"> if (!this.length) return  </span><br><span class="line">  </span><br><span class="line"> var elem = this[0],//第一个元素  </span><br><span class="line"> // Get *real* offsetParent  </span><br><span class="line"> offsetParent = this.offsetParent(),//最近非静态定位祖先元素  </span><br><span class="line"> // Get correct offsets  </span><br><span class="line"> offset = this.offset(),//相对于文档  </span><br><span class="line"> //如果祖先元素是跟节点，parentOffset为&#123;top:0,left:0&#125;  </span><br><span class="line"> //如果不是跟节点，parentOffset的值为offsetParent.offset()  </span><br><span class="line"> parentOffset = rootNodeRE.test(offsetParent[0].nodeName) ? &#123;  </span><br><span class="line"> top: 0,  </span><br><span class="line"> left: 0  </span><br><span class="line"> &#125; : offsetParent.offset()  </span><br><span class="line">  </span><br><span class="line"> // Subtract element margins  </span><br><span class="line"> // note: when an element has margin: auto the offsetLeft and marginLeft  </span><br><span class="line"> // are the same in Safari causing offset.left to incorrectly be 0  </span><br><span class="line"> //自身的offset减去margin  </span><br><span class="line"> offset.top -= parseFloat($(elem).css(&apos;margin-top&apos;)) || 0  </span><br><span class="line"> offset.left -= parseFloat($(elem).css(&apos;margin-left&apos;)) || 0  </span><br><span class="line">  </span><br><span class="line"> // Add offsetParent borders  </span><br><span class="line"> //父级的offset加上border  </span><br><span class="line"> parentOffset.top += parseFloat($(offsetParent[0]).css(&apos;border-top-width&apos;)) || 0  </span><br><span class="line"> parentOffset.left += parseFloat($(offsetParent[0]).css(&apos;border-left-width&apos;)) || 0  </span><br><span class="line">  </span><br><span class="line"> // Subtract the two offsets  </span><br><span class="line"> //两者相减  </span><br><span class="line"> return &#123;  </span><br><span class="line"> top: offset.top - parentOffset.top,  </span><br><span class="line"> left: offset.left - parentOffset.left  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //最近非静态定位的祖先元素  </span><br><span class="line"> offsetParent: function() &#123;  </span><br><span class="line"> return this.map(function() &#123;  </span><br><span class="line"> var parent = this.offsetParent || document.body //最近非静态定位  </span><br><span class="line"> //parent存在且不是根节点且parent的定位不是static  </span><br><span class="line"> while (parent &amp;&amp; !rootNodeRE.test(parent.nodeName) &amp;&amp; $(parent).css(&quot;position&quot;) == &quot;static&quot;)  </span><br><span class="line"> parent = parent.offsetParent  </span><br><span class="line"> return parent  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // for now  </span><br><span class="line"> //估计是为了新旧版本兼容... 但是在jQ中，这两者是不同的  </span><br><span class="line"> $.fn.detach = $.fn.remove  </span><br><span class="line">  </span><br><span class="line"> // Generate the `width` and `height` functions  </span><br><span class="line"> ;  </span><br><span class="line"> [&apos;width&apos;, &apos;height&apos;].forEach(function(dimension) &#123;  </span><br><span class="line">  </span><br><span class="line"> //首字母大写？  </span><br><span class="line"> var dimensionProperty = dimension.replace(/./, function(m) &#123;  </span><br><span class="line"> return m[0].toUpperCase()  </span><br><span class="line"> &#125;)  </span><br><span class="line">  </span><br><span class="line"> //生成$.fn.width,$.fn.height   </span><br><span class="line"> $.fn[dimension] = function(value) &#123;  </span><br><span class="line"> var offset, el = this[0]  </span><br><span class="line"> //取值  </span><br><span class="line"> //如果是window，返回window.innerWidth/innerHeight  </span><br><span class="line"> if (value === undefined) return isWindow(el) ? el[&apos;inner&apos; + dimensionProperty] :  </span><br><span class="line"> //如果是document，返回document.documentElement.scrollWidth/scrollHeight  </span><br><span class="line"> isDocument(el) ? el.documentElement[&apos;scroll&apos; + dimensionProperty] :  </span><br><span class="line"> //返回获取其offset().width/height  </span><br><span class="line"> (offset = this.offset()) &amp;&amp; offset[dimension]  </span><br><span class="line"> //设值，通过css。。。  </span><br><span class="line"> else return this.each(function(idx) &#123;  </span><br><span class="line"> el = $(this)  </span><br><span class="line"> el.css(dimension, funcArg(this, value, idx, el[dimension]()))  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;)  </span><br><span class="line">  </span><br><span class="line"> //自身和子元素都会调用下fun  </span><br><span class="line"> function traverseNode(node, fun) &#123;  </span><br><span class="line"> fun(node)  </span><br><span class="line"> for (var i = 0, len = node.childNodes.length; i &lt; len; i++)  </span><br><span class="line"> traverseNode(node.childNodes[i], fun)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // Generate the `after`, `prepend`, `before`, `append`,  </span><br><span class="line"> // `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.  </span><br><span class="line"> //遍历adjacencyOperators   </span><br><span class="line"> adjacencyOperators.forEach(function(operator, operatorIndex) &#123;  </span><br><span class="line"> //话说这么写不太科学啊，数组换个位置不就bug了  </span><br><span class="line"> var inside = operatorIndex % 2 //=&gt; prepend, append  </span><br><span class="line">  </span><br><span class="line"> //生成$.fn.xxx  </span><br><span class="line"> $.fn[operator] = function() &#123;  </span><br><span class="line"> // arguments can be nodes, arrays of nodes, Zepto objects and HTML strings  </span><br><span class="line"> var argType, nodes = $.map(arguments, function(arg) &#123;//参数类型  </span><br><span class="line"> argType = type(arg)//获取参数类型  </span><br><span class="line"> //如果参数是对象、数组或者null或者undefined，nodes=arg，否则nodes=生成的html片段  </span><br><span class="line"> return argType == &quot;object&quot; || argType == &quot;array&quot; || arg == null ?  </span><br><span class="line"> arg : zepto.fragment(arg)  </span><br><span class="line"> &#125;),  </span><br><span class="line"> parent, copyByClone = this.length &gt; 1//是否需要深度克隆  </span><br><span class="line"> if (nodes.length &lt; 1) return this//如果nodes为null，undefined或者空数组或者空的zepto.Z的实例，直接返回this  </span><br><span class="line">  </span><br><span class="line"> //遍历this  </span><br><span class="line"> return this.each(function(_, target) &#123;  </span><br><span class="line"> //如果是prepend, append，parent取值target，否则取值target的父节点  </span><br><span class="line"> //因为后面都要转成before操作，所以这里要转一下target  </span><br><span class="line"> parent = inside ? target : target.parentNode  </span><br><span class="line">  </span><br><span class="line"> // convert all methods to a &quot;before&quot; operation  </span><br><span class="line"> // 都转为before操作  </span><br><span class="line"> target = operatorIndex == 0 ? target.nextSibling ://operatorIndex为0，target为target的下一个兄弟元素  </span><br><span class="line"> operatorIndex == 1 ? target.firstChild ://operatorIndex为1，target为target的第一个子元素  </span><br><span class="line"> operatorIndex == 2 ? target ://operatorIndex为2，target为target  </span><br><span class="line"> null//operatorIndex为3，target为null  </span><br><span class="line">  </span><br><span class="line"> var parentInDocument = $.contains(document.documentElement, parent)  </span><br><span class="line">  </span><br><span class="line"> nodes.forEach(function(node) &#123;  </span><br><span class="line"> if (copyByClone) node = node.cloneNode(true)//如果为true，克隆后代节点  </span><br><span class="line"> else if (!parent) return $(node).remove()//如果parent不存在，移除$(node)，返回值也是$(node)  </span><br><span class="line">  </span><br><span class="line"> parent.insertBefore(node, target)//插入节点  </span><br><span class="line"> //如果parent在document中  </span><br><span class="line"> if (parentInDocument) traverseNode(node, function(el) &#123;  </span><br><span class="line"> //nodeName不为null且是script且type属性不存在或者为text/javascript  </span><br><span class="line"> if (el.nodeName != null &amp;&amp; el.nodeName.toUpperCase() === &apos;SCRIPT&apos; &amp;&amp; (!el.type || el.type === &apos;text/javascript&apos;) &amp;&amp; !el.src)  </span><br><span class="line"> //eval全局环境执行script中的代码  </span><br><span class="line"> //这里可以拓展下关注eval的直接调用和间接调用  </span><br><span class="line"> window[&apos;eval&apos;].call(window, el.innerHTML)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;)  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> // after    =&gt; insertAfter  </span><br><span class="line"> // prepend  =&gt; prependTo  </span><br><span class="line"> // before   =&gt; insertBefore  </span><br><span class="line"> // append   =&gt; appendTo  </span><br><span class="line"> $.fn[inside ? operator + &apos;To&apos; : &apos;insert&apos; + (operatorIndex ? &apos;Before&apos; : &apos;After&apos;)] = function(html) &#123;  </span><br><span class="line"> $(html)[operator](this)  </span><br><span class="line"> return this  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;)  </span><br><span class="line">  </span><br><span class="line"> //这一句很关键  </span><br><span class="line"> //zepto.isZ能正确判断继承关系就是因为它  </span><br><span class="line"> zepto.Z.prototype = Z.prototype = $.fn  </span><br><span class="line">  </span><br><span class="line"> // Export internal API functions in the `$.zepto` namespace  </span><br><span class="line"> zepto.uniq = uniq //去重  </span><br><span class="line"> zepto.deserializeValue = deserializeValue //与toString相反  </span><br><span class="line"> $.zepto = zepto //核心对象  </span><br><span class="line">  </span><br><span class="line"> return $  </span><br><span class="line">  </span><br><span class="line">&#125;)()  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">//绑定Zepto变量，如果$未定义，指向Zepto  </span><br><span class="line">window.Zepto = Zepto  </span><br><span class="line">window.$ === undefined &amp;&amp; (window.$ = Zepto)</span><br></pre></td></tr></table></figure>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tages#zepto" >
    <span class="tag-code">zepto</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2016/06/24/06-24-鼠标滚动距离兼容/">
        <span class="nav-arrow">← </span>
        
          鼠标滚动距离兼容
        
      </a>
    
    
      <a class="nav-right" href="/2016/07/06/07-06-比较zepto与jquery的区别/">
        
          比较zepto与jquery的区别
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://juzhishang.github.io/2016/07/06/07-06-读zepto源码（1）zepto/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "juzhishang";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "读zepto源码（1）zepto",
        owner: "juzhishang",
        repo: "juzhishang.github.io",
        oauth: {
          client_id: "19a4bb92d652487fe51f",
          client_secret: "1758eabb0def22e0a6b8edab473245799754c012"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2018 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>