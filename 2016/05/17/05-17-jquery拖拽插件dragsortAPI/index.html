<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="小前端，on my way~">
  <meta name="keyword" content="hexo-theme, vuejs">
  <title>
    
      jquery拖拽插件dragsortAPI | 鸦杀&#39;s Blog
    
  </title>
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/plugins/gitment.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdn.bootcss.com/nprogress/0.2.0/nprogress.min.js"></script>
  <script src="/js/qrious.js"></script>
<script src="/js/gitment.js"></script>
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


</head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>

  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <!--<div class="logo"></div>-->
      <span>鸦杀's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
  </div>
</header>

    <div id="article-banner">
  <h2>jquery拖拽插件dragsortAPI</h2>
  <p class="post-date">2016-05-17</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><h4 id="API说明"><a href="#API说明" class="headerlink" title="API说明"></a>API说明</h4><p>dragsort中传入ops配置项，ops参数如下：</p>
<ul>
<li><p>itemSelector:可被拖拽列表的css选择器，默认是’li’或者容器的第一个子元素标签。</p>
</li>
<li><p>dragSelector:CSS选择器内的元素的列表项的拖动手柄。默认是’li’或者容器的第一个子元素标签。</p>
</li>
<li><p>dragSelectorExclude:CSS选择器的元素内的dragSelector不会触发dragsort的。默认值是”input, textarea, a[href]”。</p>
</li>
<li><p>dragEnd:拖动结束后将被调用的回调函数.</p>
</li>
<li><p>dragBetween:设置为“true”，如果你要启用多组列表之间拖动选定的列表。 默认值是false。</p>
</li>
<li><p>placeHolderTemplate:拖动列表的占位符模板。默认值是<code>”&lt;li&gt;&amp;nbsp;&lt;/li&gt;”</code>或者根据容器的第一个子元素标签创建.</p>
</li>
<li><p>scrollContainer:CSS选择器的元素，作为滚动容器，例如溢出的div设置为自动。 默认值是“window“.</p>
</li>
<li><p>scrollSpeed:滚动速度，如果设置为”0″以禁用滚动。默认值是”5″.</p>
</li>
</ul>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(&quot;ul&quot;).dragsort(&#123;  </span><br><span class="line"> dragSelector: &quot;li&quot;,  </span><br><span class="line"> dragEnd: function() &#123; &#125;,  </span><br><span class="line"> dragBetween: false,  </span><br><span class="line"> placeHolderTemplate: &quot;&amp;nbsp;&quot;  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="坑点："><a href="#坑点：" class="headerlink" title="坑点："></a>坑点：</h4><p>1、如果初始容器内没有item，$(selector).dragsort(ops)执行后，动态创建的item无法拖拽。</p>
<p>2、如果初始容器内有item,$(selector).dragsort(ops)也已经执行。再次调用$(selector).dragsort(ops)item将无法拖拽。涉及到多组拖拽列表，动态添加item的情况，需要判断该容器中是否有item，是否被绑定过。容器的data-listidx属性可以帮我们判断这个问题。</p>
<p>3、$(selector).dragsort(ops)每次调用，都会把当前的selector重新排data-listidx，所以如果存在两个组,其中一个无item，$(selector).dragsort(ops)只添加了一个data-listidx，值为0。另一个在添加item后执行$(selector).dragsort(ops)，它的data-listidx值也为0。会存在重复idx的情况，这样的话，多组之间的拖拽必然是有问题的。</p>
<h4 id="源码解读"><a href="#源码解读" class="headerlink" title="源码解读"></a>源码解读</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br></pre></td><td class="code"><pre><span class="line">// jQuery List DragSort v0.5.2  </span><br><span class="line">// Website: http://dragsort.codeplex.com/  </span><br><span class="line">// License: http://dragsort.codeplex.com/license  </span><br><span class="line">  </span><br><span class="line">(function($) &#123;  </span><br><span class="line">  </span><br><span class="line"> $.fn.dragsort = function(options) &#123;  </span><br><span class="line"> //如果选项是destroy  </span><br><span class="line"> if (options == &quot;destroy&quot;) &#123;  </span><br><span class="line"> //选择器触发dragsort-uninit  </span><br><span class="line"> $(this.selector).trigger(&quot;dragsort-uninit&quot;);  </span><br><span class="line"> return;  </span><br><span class="line"> &#125;  </span><br><span class="line"> //获取配置  </span><br><span class="line"> var opts = $.extend(&#123;&#125;, $.fn.dragsort.defaults, options);  </span><br><span class="line"> //列表数组初始化  </span><br><span class="line"> var lists = [];  </span><br><span class="line"> //列表，上一次位置  </span><br><span class="line"> var list = null,  </span><br><span class="line"> lastPos = null;  </span><br><span class="line">  </span><br><span class="line"> //index &amp; 容器  </span><br><span class="line"> this.each(function(i, cont) &#123;  </span><br><span class="line"> //如果容器是表格，且容器子元素为1，且子元素为tbody  </span><br><span class="line"> //if list container is table, the browser automatically wraps rows in tbody if not specified so change list container to tbody so that children returns rows as user expected  </span><br><span class="line"> if ($(cont).is(&quot;table&quot;) &amp;&amp; $(cont).children().size() == 1 &amp;&amp; $(cont).children().is(&quot;tbody&quot;))  </span><br><span class="line"> cont = $(cont).children().get(0); //容器改为tbody  </span><br><span class="line">  </span><br><span class="line"> var newList = &#123;  </span><br><span class="line"> draggedItem: null, //被拖拽元素  </span><br><span class="line"> placeHolderItem: null, //占位元素  </span><br><span class="line"> pos: null, //位置  </span><br><span class="line"> offset: null, //偏移  </span><br><span class="line"> offsetLimit: null, //最大偏移  </span><br><span class="line"> scroll: null, //滚动  </span><br><span class="line"> container: cont, //容器  </span><br><span class="line">  </span><br><span class="line"> init: function() &#123;  </span><br><span class="line"> //set options to default values if not set  </span><br><span class="line"> //如果容器的子元素为0，设置opts。tagName为li,否则，获取容器第一个子元素的小写标签名，这里说明，容器必须是列表的直接父元素  </span><br><span class="line"> opts.tagName = $(this.container).children().size() == 0 ? &quot;li&quot; : $(this.container).children().get(0).tagName.toLowerCase();  </span><br><span class="line"> if (opts.itemSelector == &quot;&quot;) //设置itemSelector  </span><br><span class="line"> opts.itemSelector = opts.tagName;  </span><br><span class="line"> if (opts.dragSelector == &quot;&quot;) //设置dragSelector  </span><br><span class="line"> opts.dragSelector = opts.tagName;  </span><br><span class="line"> if (opts.placeHolderTemplate == &quot;&quot;) //设置占位符模板，就是一个空的item  </span><br><span class="line"> opts.placeHolderTemplate = &quot; + opts.tagName + &quot;&gt;&amp;nbsp; + opts.tagName + &quot;&gt;&quot;;  </span><br><span class="line">  </span><br><span class="line"> //listidx allows reference back to correct list variable instance  </span><br><span class="line"> //为容器设置data-listidx的值为index  </span><br><span class="line"> //鼠标按下时为被拖拽的元素绑定mousedown的回调，绑定dragsort-uninit方法的回调，回调函数是this.uninit  </span><br><span class="line"> $(this.container).attr(&quot;data-listidx&quot;, i).mousedown(this.grabItem).bind(&quot;dragsort-uninit&quot;, this.uninit);  </span><br><span class="line"> this.styleDragHandlers(true);  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> uninit: function() &#123;  </span><br><span class="line"> //获取容器data-listidx属性的index,以index为下标获取了lists数组中的list  </span><br><span class="line"> var list = lists[$(this).attr(&quot;data-listidx&quot;)];  </span><br><span class="line"> //容器解绑mousedown和dragsort-uninit之前绑定的回调  </span><br><span class="line"> $(list.container).unbind(&quot;mousedown&quot;, list.grabItem).unbind(&quot;dragsort-uninit&quot;);  </span><br><span class="line"> list.styleDragHandlers(false);  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //获取容器中的子元素  </span><br><span class="line"> getItems: function() &#123;  </span><br><span class="line"> return $(this.container).children(opts.itemSelector);  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //设置拖拽元素的cursor值  </span><br><span class="line"> styleDragHandlers: function(cursor) &#123;  </span><br><span class="line"> //获取容器中的子元素，map的作用是遍历后返回新数组  </span><br><span class="line"> this.getItems().map(function() &#123;  </span><br><span class="line"> //如果当前item是配置中的可拖拽元素，返回当前item  </span><br><span class="line"> //获取当前item下找到的可拖拽元素  </span><br><span class="line"> return $(this).is(opts.dragSelector) ? this : $(this).find(opts.dragSelector).get();  </span><br><span class="line"> &#125;)  </span><br><span class="line"> .css(&quot;cursor&quot;, cursor ? &quot;pointer&quot; : &quot;&quot;); //返回的数组集合中，设置这些元素的css cursor值  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> grabItem: function(e) &#123;  </span><br><span class="line"> //获取容器data-listidx属性的index,以index为下标获取了lists数组中的list  </span><br><span class="line"> var list = lists[$(this).attr(&quot;data-listidx&quot;)];  </span><br><span class="line"> //获取点击元素的最近匹配的父容器中的第一个item  </span><br><span class="line"> var item = $(e.target).closest(&quot;[data-listidx] &gt; &quot; + opts.tagName).get(0);  </span><br><span class="line"> //list获取item集合，如果item中至少有一个等于list中的item，说明在可移动的item中  </span><br><span class="line"> var insideMoveableItem = list.getItems().filter(function() &#123;  </span><br><span class="line"> return this == item;  </span><br><span class="line"> &#125;).size() &gt; 0;  </span><br><span class="line">  </span><br><span class="line"> //if not left click or if clicked on excluded element (e.g. text box) or not a moveable list item return  </span><br><span class="line"> //不是鼠标左击或者点击在排除元素或者它最近的父元素是排除元素或者不在不在可移动的列表里  </span><br><span class="line"> if (e.which != 1 || $(e.target).is(opts.dragSelectorExclude) || $(e.target).closest(opts.dragSelectorExclude).size() &gt; 0 || !insideMoveableItem)  </span><br><span class="line"> return;  </span><br><span class="line">  </span><br><span class="line"> //prevents selection, stops issue on Fx where dragging hyperlink doesn&apos;t work and on IE where it triggers mousemove even though mouse hasn&apos;t moved,  </span><br><span class="line"> //does also stop being able to click text boxes hence dragging on text boxes by default is disabled in dragSelectorExclude  </span><br><span class="line"> e.preventDefault();  </span><br><span class="line">  </span><br><span class="line"> //change cursor to move while dragging  </span><br><span class="line"> //拖拽元素为目标对象  </span><br><span class="line"> var dragHandle = e.target;  </span><br><span class="line"> //如果拖拽元素是配置中可拖拽元素  </span><br><span class="line"> while (!$(dragHandle).is(opts.dragSelector)) &#123;  </span><br><span class="line"> //如果拖拽元素是容器，返回  </span><br><span class="line"> if (dragHandle == this) return;  </span><br><span class="line"> //设置拖拽元素为它的父节点  </span><br><span class="line"> dragHandle = dragHandle.parentNode;  </span><br><span class="line"> &#125;  </span><br><span class="line"> //设置拖拽元素的data-cursor属性为它的css属性cursor的值，所以是暂存原来的cursor属性  </span><br><span class="line"> $(dragHandle).attr(&quot;data-cursor&quot;, $(dragHandle).css(&quot;cursor&quot;));  </span><br><span class="line"> //设置拖拽元素的cursor为move  </span><br><span class="line"> $(dragHandle).css(&quot;cursor&quot;, &quot;move&quot;);  </span><br><span class="line">  </span><br><span class="line"> //on mousedown wait for movement of mouse before triggering dragsort script (dragStart) to allow clicking of hyperlinks to work  </span><br><span class="line"> var listElem = this; //这里this指向容器  </span><br><span class="line"> //定义trigger方法  </span><br><span class="line"> var trigger = function() &#123;  </span><br><span class="line"> list.dragStart.call(listElem, e); //调用dragStart方法，this指向listElem  </span><br><span class="line"> $(list.container).unbind(&quot;mousemove&quot;, trigger); //容器的container解绑mousemove  </span><br><span class="line"> &#125;;  </span><br><span class="line"> //container mousemove时触发trigger方法，鼠标弹起时解绑trigger,拖拽元素回写原来的cursor属性  </span><br><span class="line"> $(list.container).mousemove(trigger).mouseup(function() &#123;  </span><br><span class="line"> $(list.container).unbind(&quot;mousemove&quot;, trigger);  </span><br><span class="line"> $(dragHandle).css(&quot;cursor&quot;, $(dragHandle).attr(&quot;data-cursor&quot;));  </span><br><span class="line"> &#125;);  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> dragStart: function(e) &#123;  </span><br><span class="line"> //这里的list是全局定义的那个数组  </span><br><span class="line"> //如果list不为null 且 list.draggedItem不存在  </span><br><span class="line"> if (list != null &amp;&amp; list.draggedItem != null)  </span><br><span class="line"> list.dropItem(); //调用list.dropItem方法  </span><br><span class="line">  </span><br><span class="line"> list = lists[$(this).attr(&quot;data-listidx&quot;)]; //获取当前容器  </span><br><span class="line"> //设置draggedItem为事件目标的最近的父级item  </span><br><span class="line"> list.draggedItem = $(e.target).closest(&quot;[data-listidx] &gt; &quot; + opts.tagName)  </span><br><span class="line">  </span><br><span class="line"> //record current position so on dragend we know if the dragged item changed position or not, not using getItems to allow dragsort to restore dragged item to original location in relation to fixed items  </span><br><span class="line"> //设置其data-listidx为容器的data-listidx属性值+&apos;-&apos;+该item在容器中的index，比如0-1  </span><br><span class="line"> list.draggedItem.attr(&quot;data-origpos&quot;, $(this).attr(&quot;data-listidx&quot;) + &quot;-&quot; + $(list.container).children().index(list.draggedItem));  </span><br><span class="line">  </span><br><span class="line"> //calculate mouse offset relative to draggedItem  </span><br><span class="line"> ////获取marginTop与marginLeft值  </span><br><span class="line"> var mt = parseInt(list.draggedItem.css(&quot;marginTop&quot;));  </span><br><span class="line"> var ml = parseInt(list.draggedItem.css(&quot;marginLeft&quot;));  </span><br><span class="line"> //设置鼠标相对于拖拽元素的offset  </span><br><span class="line"> list.offset = list.draggedItem.offset();  </span><br><span class="line"> list.offset.top = e.pageY - list.offset.top + (isNaN(mt) ? 0 : mt) - 1;  </span><br><span class="line"> list.offset.left = e.pageX - list.offset.left + (isNaN(ml) ? 0 : ml) - 1;  </span><br><span class="line">  </span><br><span class="line"> //calculate box the dragged item can&apos;t be dragged outside of  </span><br><span class="line"> //如果dragBetween存在  </span><br><span class="line"> if (!opts.dragBetween) &#123;  </span><br><span class="line"> //如果容器的outerHeight为0，item的数量*item的outerWidth/容器的outerWidth获取行数，行数再去乘以item的outerHeight，不为0的话就直接返回容器的outerHeight  </span><br><span class="line"> var containerHeight = $(list.container).outerHeight() == 0 ? Math.max(1, Math.round(0.5 + list.getItems().size() * list.draggedItem.outerWidth() / $(list.container).outerWidth())) * list.draggedItem.outerHeight() : $(list.container).outerHeight();  </span><br><span class="line"> list.offsetLimit = $(list.container).offset(); //设置offset限制，不能拖拽超出容器  </span><br><span class="line"> list.offsetLimit.right = list.offsetLimit.left + $(list.container).outerWidth() - list.draggedItem.outerWidth();  </span><br><span class="line"> list.offsetLimit.bottom = list.offsetLimit.top + containerHeight - list.draggedItem.outerHeight();  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //create placeholder item  </span><br><span class="line"> //获取拖拽元素的高宽  </span><br><span class="line"> var h = list.draggedItem.height();  </span><br><span class="line"> var w = list.draggedItem.width();  </span><br><span class="line"> //如果item为tr  </span><br><span class="line"> if (opts.tagName == &quot;tr&quot;) &#123;  </span><br><span class="line"> //遍历tr中的每个元素，设置宽度  </span><br><span class="line"> list.draggedItem.children().each(function() &#123;  </span><br><span class="line"> $(this).width($(this).width());  </span><br><span class="line"> &#125;);  </span><br><span class="line"> //占位符元素为拖拽元素的复本并设置其data-placeholder属性为true  </span><br><span class="line"> list.placeHolderItem = list.draggedItem.clone().attr(&quot;data-placeholder&quot;, true);  </span><br><span class="line"> list.draggedItem.after(list.placeHolderItem); //在拖拽元素的后面一个位置插入占位符元素  </span><br><span class="line"> //遍历占位符元素的每一个子元素，设置边框宽度为0，宽度+1高度+1，内容为0  </span><br><span class="line"> list.placeHolderItem.children().each(function() &#123;  </span><br><span class="line"> $(this).css(&#123;  </span><br><span class="line"> borderWidth: 0,  </span><br><span class="line"> width: $(this).width() + 1,  </span><br><span class="line"> height: $(this).height() + 1  </span><br><span class="line"> &#125;).html(&quot;&amp;nbsp;&quot;);  </span><br><span class="line"> &#125;);  </span><br><span class="line"> &#125; else &#123; //如果不是tr  </span><br><span class="line"> list.draggedItem.after(opts.placeHolderTemplate); //在拖拽元素的后面一个位置插入占位符模板  </span><br><span class="line"> list.placeHolderItem = list.draggedItem.next().css(&#123;  </span><br><span class="line"> height: h,  </span><br><span class="line"> width: w  </span><br><span class="line"> &#125;).attr(&quot;data-placeholder&quot;, true); //设置占位符高宽及其data-placeholder属性为true  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //如果item为td  </span><br><span class="line"> if (opts.tagName == &quot;td&quot;) &#123;  </span><br><span class="line"> var listTable = list.draggedItem.closest(&quot;table&quot;).get(0); //获取最近的父元素表格  </span><br><span class="line"> //创建一个空表格，添加到body中，获取空表格的子元素也就是tbody，将被拖拽的元素append到tbody中  </span><br><span class="line"> $(&quot; + listTable.id + &quot;&quot; style=&quot;border-width: 0px;&quot; class=&quot;dragSortItem &quot; + listTable.className + &quot;&quot;&gt;&quot;).appendTo(&quot;body&quot;).children().append(list.draggedItem);  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //style draggedItem while dragging  </span><br><span class="line"> var orig = list.draggedItem.attr(&quot;style&quot;); //获取拖拽元素的style属性值  </span><br><span class="line"> list.draggedItem.attr(&quot;data-origstyle&quot;, orig ? orig : &quot;&quot;); //暂存到data-origstyle中  </span><br><span class="line"> //设置拖拽元素为绝对定位，透明度0.8，z-index999，以及相应的高宽  </span><br><span class="line"> list.draggedItem.css(&#123;  </span><br><span class="line"> position: &quot;absolute&quot;,  </span><br><span class="line"> opacity: 0.8,  </span><br><span class="line"> &quot;z-index&quot;: 999,  </span><br><span class="line"> height: h,  </span><br><span class="line"> width: w  </span><br><span class="line"> &#125;);  </span><br><span class="line">  </span><br><span class="line"> //auto-scroll setup  </span><br><span class="line"> //设置容器的scroll对象，存储移动坐标和最大的坐标  </span><br><span class="line"> list.scroll = &#123;  </span><br><span class="line"> moveX: 0,  </span><br><span class="line"> moveY: 0,  </span><br><span class="line"> maxX: $(document).width() - $(window).width(),  </span><br><span class="line"> maxY: $(document).height() - $(window).height()  </span><br><span class="line"> &#125;;  </span><br><span class="line"> //设置定时器list.scroll.scrollY,间隔时间10毫秒  </span><br><span class="line"> list.scroll.scrollY = window.setInterval(function() &#123;  </span><br><span class="line"> //如果容器不是window  </span><br><span class="line"> if (opts.scrollContainer != window) &#123;  </span><br><span class="line"> //设置其容器的scrollTop为原来的scrollTop值+鼠标移动的Y值  </span><br><span class="line"> $(opts.scrollContainer).scrollTop($(opts.scrollContainer).scrollTop() + list.scroll.moveY);  </span><br><span class="line"> return;  </span><br><span class="line"> &#125;  </span><br><span class="line"> var t = $(opts.scrollContainer).scrollTop(); //获取容器的scrollTop  </span><br><span class="line"> //如果滚动距离Y大于0，并且容器的scrollTop小于maxY  </span><br><span class="line"> //或者moveY小于0（向下移动？）且容器的scrollTop大于0、  </span><br><span class="line"> //这是判断有没有滚出限制  </span><br><span class="line"> if (list.scroll.moveY &gt; 0 &amp;&amp; t &lt; list.scroll.maxY || list.scroll.moveY &lt; 0 &amp;&amp; t &gt; 0) &#123;  </span><br><span class="line"> //设置容器的scrollTop为原有的+移动的  </span><br><span class="line"> $(opts.scrollContainer).scrollTop(t + list.scroll.moveY);  </span><br><span class="line"> //设置拖拽元素的top值为它的offset的top值+滚动Y值+1  </span><br><span class="line"> list.draggedItem.css(&quot;top&quot;, list.draggedItem.offset().top + list.scroll.moveY + 1);  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;, 10);  </span><br><span class="line"> //处理同Y  </span><br><span class="line"> list.scroll.scrollX = window.setInterval(function() &#123;  </span><br><span class="line"> if (opts.scrollContainer != window) &#123;  </span><br><span class="line"> $(opts.scrollContainer).scrollLeft($(opts.scrollContainer).scrollLeft() + list.scroll.moveX);  </span><br><span class="line"> return;  </span><br><span class="line"> &#125;  </span><br><span class="line"> var l = $(opts.scrollContainer).scrollLeft();  </span><br><span class="line"> if (list.scroll.moveX &gt; 0 &amp;&amp; l &lt; list.scroll.maxX || list.scroll.moveX &lt; 0 &amp;&amp; l &gt; 0) &#123;  </span><br><span class="line"> $(opts.scrollContainer).scrollLeft(l + list.scroll.moveX);  </span><br><span class="line"> list.draggedItem.css(&quot;left&quot;, list.draggedItem.offset().left + list.scroll.moveX + 1);  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;, 10);  </span><br><span class="line">  </span><br><span class="line"> //misc  </span><br><span class="line"> //遍历所有容器，调用容器的createDropTargets方法，调用容器的buildPositionTable方法，这里很奇怪，为什么要对其他的容器也遍历一遍  </span><br><span class="line"> $(lists).each(function(i, l) &#123;  </span><br><span class="line"> l.createDropTargets();  </span><br><span class="line"> l.buildPositionTable();  </span><br><span class="line"> &#125;);  </span><br><span class="line"> list.setPos(e.pageX, e.pageY); //设置被拖拽元素的位置  </span><br><span class="line"> $(document).bind(&quot;mousemove&quot;, list.swapItems); //document绑定mousemove方法  </span><br><span class="line"> $(document).bind(&quot;mouseup&quot;, list.dropItem); //mouseup时绑定dropItem方法  </span><br><span class="line"> if (opts.scrollContainer != window) //如果滚动容器不是window  </span><br><span class="line"> $(window).bind(&quot;wheel&quot;, list.wheel); //window绑定wheel方法  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //set position of draggedItem  </span><br><span class="line"> //设置被拖拽元素的位置  </span><br><span class="line"> setPos: function(x, y) &#123;  </span><br><span class="line"> //remove mouse offset so mouse cursor remains in same place on draggedItem instead of top left corner  </span><br><span class="line"> var top = y - this.offset.top; //鼠标的位置-被拖拽元素的offset值，就是鼠标在被拖拽元素中的位置  </span><br><span class="line"> var left = x - this.offset.left;  </span><br><span class="line">  </span><br><span class="line"> //limit top, left to within box draggedItem can&apos;t be dragged outside of  </span><br><span class="line"> if (!opts.dragBetween) &#123; //如果不是dragBetween  </span><br><span class="line"> top = Math.min(this.offsetLimit.bottom, Math.max(top, this.offsetLimit.top));  </span><br><span class="line"> left = Math.min(this.offsetLimit.right, Math.max(left, this.offsetLimit.left));  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //adjust top &amp; left calculations to parent offset  </span><br><span class="line"> //获取被拖拽元素的最近的非相对定位且不是body的父元素的offset  </span><br><span class="line"> var parent = this.draggedItem.offsetParent().not(&quot;body&quot;).offset(); //offsetParent returns body even when it&apos;s static, if not static offset is only factoring margin  </span><br><span class="line"> if (parent != null) &#123; //如果parent存在  </span><br><span class="line"> top -= parent.top;  </span><br><span class="line"> left -= parent.left;  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //set x or y auto-scroll amount  </span><br><span class="line"> if (opts.scrollContainer == window) &#123; //如果容器是window  </span><br><span class="line"> y -= $(window).scrollTop();  </span><br><span class="line"> x -= $(window).scrollLeft();  </span><br><span class="line"> y = Math.max(0, y - $(window).height() + 5) + Math.min(0, y - 5);  </span><br><span class="line"> x = Math.max(0, x - $(window).width() + 5) + Math.min(0, x - 5);  </span><br><span class="line"> &#125; else &#123; //如果不是window  </span><br><span class="line"> var cont = $(opts.scrollContainer);  </span><br><span class="line"> var offset = cont.offset(); //获取容器的offset  </span><br><span class="line"> //计算x,y  </span><br><span class="line"> y = Math.max(0, y - cont.height() - offset.top) + Math.min(0, y - offset.top);  </span><br><span class="line"> x = Math.max(0, x - cont.width() - offset.left) + Math.min(0, x - offset.left);  </span><br><span class="line"> &#125;  </span><br><span class="line"> //如果x为0，moveX为0，如果不为0，moveX为x*滚动速度/x的绝对值  </span><br><span class="line"> list.scroll.moveX = x == 0 ? 0 : x * opts.scrollSpeed / Math.abs(x);  </span><br><span class="line"> list.scroll.moveY = y == 0 ? 0 : y * opts.scrollSpeed / Math.abs(y);  </span><br><span class="line">  </span><br><span class="line"> //move draggedItem to new mouse cursor location  </span><br><span class="line"> //设置被拖拽元素的top值与left值  </span><br><span class="line"> this.draggedItem.css(&#123;  </span><br><span class="line"> top: top,  </span><br><span class="line"> left: left  </span><br><span class="line"> &#125;);  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //if scroll container is a div allow mouse wheel to scroll div instead of window when mouse is hovering over  </span><br><span class="line"> wheel: function(e) &#123;  </span><br><span class="line"> if (list &amp;&amp; opts.scrollContainer != window) &#123; //如果容器存在且滚动元素不是window  </span><br><span class="line"> var cont = $(opts.scrollContainer); //缓存容器  </span><br><span class="line"> var offset = cont.offset(); //获取容器的offset值  </span><br><span class="line"> e = e.originalEvent;  </span><br><span class="line"> //如果鼠标在容器中  </span><br><span class="line"> if (e.clientX &gt; offset.left &amp;&amp; e.clientX &lt; offset.left + cont.width() &amp;&amp; e.clientY &gt; offset.top &amp;&amp; e.clientY &lt; offset.top + cont.height()) &#123;  </span><br><span class="line"> var deltaY = (e.deltaMode == 0 ? 1 : 10) * e.deltaY; //计算步长？？  </span><br><span class="line"> cont.scrollTop(cont.scrollTop() + deltaY); //滚动设置容器的scrollTop值  </span><br><span class="line"> e.preventDefault();  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //build a table recording all the positions of the moveable list items  </span><br><span class="line"> //建表记录所有可移动item的位置  </span><br><span class="line"> buildPositionTable: function() &#123;  </span><br><span class="line"> var pos = [];  </span><br><span class="line"> //获取当前容器中所有的item中不是被拖拽和占位符的元素，遍历  </span><br><span class="line"> this.getItems().not([list.draggedItem[0], list.placeHolderItem[0]]).each(function(i) &#123;  </span><br><span class="line"> var loc = $(this).offset(); //获取每个元素的offset()  </span><br><span class="line"> //记录他们的位置和元素  </span><br><span class="line"> loc.right = loc.left + $(this).outerWidth();  </span><br><span class="line"> loc.bottom = loc.top + $(this).outerHeight();  </span><br><span class="line"> loc.elm = this;  </span><br><span class="line"> pos[i] = loc;  </span><br><span class="line"> &#125;);  </span><br><span class="line"> this.pos = pos;  </span><br><span class="line"> &#125;,  </span><br><span class="line"> //释放item?  </span><br><span class="line"> dropItem: function() &#123;  </span><br><span class="line"> //如果被拖拽元素不存在，返回  </span><br><span class="line"> if (list.draggedItem == null)  </span><br><span class="line"> return;  </span><br><span class="line">  </span><br><span class="line"> //list.draggedItem.attr(&quot;style&quot;, &quot;&quot;) doesn&apos;t work on IE8 and jQuery 1.5 or lower  </span><br><span class="line"> //list.draggedItem.removeAttr(&quot;style&quot;) doesn&apos;t work on chrome and jQuery 1.6 (works jQuery 1.5 or lower)  </span><br><span class="line"> //获取ata-origstyle属性  </span><br><span class="line"> var orig = list.draggedItem.attr(&quot;data-origstyle&quot;);  </span><br><span class="line"> //回写属性style  </span><br><span class="line"> list.draggedItem.attr(&quot;style&quot;, orig);  </span><br><span class="line"> //如果原属性为空  </span><br><span class="line"> if (orig == &quot;&quot;)  </span><br><span class="line"> //移除style  </span><br><span class="line"> list.draggedItem.removeAttr(&quot;style&quot;);  </span><br><span class="line"> list.draggedItem.removeAttr(&quot;data-origstyle&quot;);  </span><br><span class="line">  </span><br><span class="line"> //设置拖拽元素的cursor值为pointer  </span><br><span class="line"> list.styleDragHandlers(true);  </span><br><span class="line">  </span><br><span class="line"> //占位符前面添加被拖拽元素，然后移除占位符  </span><br><span class="line"> list.placeHolderItem.before(list.draggedItem);  </span><br><span class="line"> list.placeHolderItem.remove();  </span><br><span class="line">  </span><br><span class="line"> //移除什么鬼，没看明白  </span><br><span class="line"> $(&quot;[data-droptarget], .dragSortItem&quot;).remove();  </span><br><span class="line">  </span><br><span class="line"> //清除浮动  </span><br><span class="line"> window.clearInterval(list.scroll.scrollY);  </span><br><span class="line"> window.clearInterval(list.scroll.scrollX);  </span><br><span class="line">  </span><br><span class="line"> //if position changed call dragEnd  </span><br><span class="line"> //如果被拖拽元素的属性data-origpos不等于当前容器的idx-容器中被拖拽元素的index,说明位置变了  </span><br><span class="line"> if (list.draggedItem.attr(&quot;data-origpos&quot;) != $(lists).index(list) + &quot;-&quot; + $(list.container).children().index(list.draggedItem))  </span><br><span class="line"> if (opts.dragEnd.apply(list.draggedItem) == false) &#123; //if dragEnd returns false revert order  </span><br><span class="line"> var pos = list.draggedItem.attr(&quot;data-origpos&quot;).split(&apos;-&apos;); //获取位置数组  </span><br><span class="line"> var nextItem = $(lists[pos[0]].container).children().not(list.draggedItem).eq(pos[1]); //获取下一个item  </span><br><span class="line"> if (nextItem.size() &gt; 0) //如果下一个item存在  </span><br><span class="line"> nextItem.before(list.draggedItem); //再它1前面插入被拖拽的元素  </span><br><span class="line"> else if (pos[1] == 0) //was the only item in list//如果是唯一元素  </span><br><span class="line"> $(lists[pos[0]].container).prepend(list.draggedItem);  </span><br><span class="line"> else //was the last item in list  </span><br><span class="line"> //如果是最后一个元素  </span><br><span class="line"> $(lists[pos[0]].container).append(list.draggedItem);  </span><br><span class="line"> &#125;  </span><br><span class="line"> //移除原位置属性  </span><br><span class="line"> list.draggedItem.removeAttr(&quot;data-origpos&quot;);  </span><br><span class="line"> //dragItem设为null  </span><br><span class="line"> list.draggedItem = null;  </span><br><span class="line"> //解绑事件  </span><br><span class="line"> $(document).unbind(&quot;mousemove&quot;, list.swapItems);  </span><br><span class="line"> $(document).unbind(&quot;mouseup&quot;, list.dropItem);  </span><br><span class="line"> //如果滚动容器不为window,解绑wheel  </span><br><span class="line"> if (opts.scrollContainer != window)  </span><br><span class="line"> $(window).unbind(&quot;wheel&quot;, list.wheel);  </span><br><span class="line"> return false;  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //swap the draggedItem (represented visually by placeholder) with the list item the it has been dragged on top of  </span><br><span class="line"> swapItems: function(e) &#123;  </span><br><span class="line"> if (list.draggedItem == null) //如果没有拖拽元素，返回  </span><br><span class="line"> return false;  </span><br><span class="line">  </span><br><span class="line"> //move draggedItem to mouse location  </span><br><span class="line"> list.setPos(e.pageX, e.pageY); //将拖拽元素移动到鼠标位置  </span><br><span class="line">  </span><br><span class="line"> //retrieve list and item position mouse cursor is over  </span><br><span class="line"> var ei = list.findPos(e.pageX, e.pageY); //获取鼠标所处位置的item的index  </span><br><span class="line"> var nlist = list;  </span><br><span class="line"> //如果ei为-1（未找到）且dragBetween为true  </span><br><span class="line"> for (var i = 0; ei == -1 &amp;&amp; opts.dragBetween &amp;&amp; i &lt; lists.length; i++) &#123;  </span><br><span class="line"> //在其它容器中找  </span><br><span class="line"> ei = lists[i].findPos(e.pageX, e.pageY);  </span><br><span class="line"> nlist = lists[i];  </span><br><span class="line"> &#125;  </span><br><span class="line">  </span><br><span class="line"> //if not over another moveable list item return  </span><br><span class="line"> //如果还是没有找到，返回  </span><br><span class="line"> if (ei == -1)  </span><br><span class="line"> return false;  </span><br><span class="line">  </span><br><span class="line"> //save fixed items locations  </span><br><span class="line"> //返回鼠标所在item的容器的非被拖拽子元素  </span><br><span class="line"> var children = function() &#123;  </span><br><span class="line"> return $(nlist.container).children().not(nlist.draggedItem);  </span><br><span class="line"> &#125;;  </span><br><span class="line"> //找到children中不是item的元素，设置index  </span><br><span class="line"> var fixed = children().not(opts.itemSelector).each(function(i) &#123;  </span><br><span class="line"> this.idx = children().index(this);  </span><br><span class="line"> &#125;);  </span><br><span class="line">  </span><br><span class="line"> //if moving draggedItem up or left place placeHolder before list item the dragged item is hovering over otherwise place it after  </span><br><span class="line"> //如果向左或向上移动，新的item要加在占位符的前面  </span><br><span class="line"> if (lastPos == null || lastPos.top &gt; list.draggedItem.offset().top || lastPos.left &gt; list.draggedItem.offset().left)  </span><br><span class="line"> $(nlist.pos[ei].elm).before(list.placeHolderItem);  </span><br><span class="line"> //否则加载占位符后面  </span><br><span class="line"> else  </span><br><span class="line"> $(nlist.pos[ei].elm).after(list.placeHolderItem);  </span><br><span class="line">  </span><br><span class="line"> //restore fixed items location  </span><br><span class="line"> //重新存储固定定位元素的位置  </span><br><span class="line"> fixed.each(function() &#123;  </span><br><span class="line"> var elm = children().eq(this.idx).get(0); //获取固定定位元素  </span><br><span class="line"> if (this != elm &amp;&amp; children().index(this) &lt; this.idx) //如果当前元素不是固定元素并且非拖拽元素中this的下标小于idx属性  </span><br><span class="line"> $(this).insertAfter(elm); //this添加到固定元素后面  </span><br><span class="line"> else if (this != elm) //否则，添加在固定元素之前  </span><br><span class="line"> $(this).insertBefore(elm);  </span><br><span class="line"> &#125;);  </span><br><span class="line">  </span><br><span class="line"> //misc  </span><br><span class="line"> //遍历所有容器，调用createDropTargets方法和buildPositionTable方法  </span><br><span class="line"> $(lists).each(function(i, l) &#123;  </span><br><span class="line"> l.createDropTargets();  </span><br><span class="line"> l.buildPositionTable();  </span><br><span class="line"> &#125;);  </span><br><span class="line"> lastPos = list.draggedItem.offset(); //设置最近一次的位置  </span><br><span class="line"> return false;  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //returns the index of the list item the mouse is over  </span><br><span class="line"> //传入鼠标的位置  </span><br><span class="line"> findPos: function(x, y) &#123;  </span><br><span class="line"> //遍历pos对象  </span><br><span class="line"> for (var i = 0; i &lt; this.pos.length; i++) &#123;  </span><br><span class="line"> //如果鼠标的位置在某个item内，返回这个item的index  </span><br><span class="line"> if (this.pos[i].left &lt; x &amp;&amp; this.pos[i].right &gt; x &amp;&amp; this.pos[i].top &lt; y &amp;&amp; this.pos[i].bottom &gt; y)  </span><br><span class="line"> return i;  </span><br><span class="line"> &#125;  </span><br><span class="line"> return -1;  </span><br><span class="line"> &#125;,  </span><br><span class="line">  </span><br><span class="line"> //create drop targets which are placeholders at the end of other lists to allow dragging straight to the last position  </span><br><span class="line"> createDropTargets: function() &#123;  </span><br><span class="line"> if (!opts.dragBetween) //如果不是dragBetween，返回.感觉between是用于跨容器拖拽  </span><br><span class="line"> return;  </span><br><span class="line">  </span><br><span class="line"> $(lists).each(function() &#123; //遍历所有的容器  </span><br><span class="line"> var ph = $(this.container).find(&quot;[data-placeholder]&quot;); //获取当前容器的占位符  </span><br><span class="line"> var dt = $(this.container).find(&quot;[data-droptarget]&quot;); //获取当前容器的droptarget，这个不知道是什么鬼  </span><br><span class="line"> if (ph.size() &gt; 0 &amp;&amp; dt.size() &gt; 0) //如果占位符存在droptarget也存在  </span><br><span class="line"> dt.remove(); //移除droptarget  </span><br><span class="line"> else if (ph.size() == 0 &amp;&amp; dt.size() == 0) &#123; //如果占位符和droptarget都不存在  </span><br><span class="line"> if (opts.tagName == &quot;td&quot;) //如果item是td  </span><br><span class="line"> //设置占位符的data-droptarget属性然后添加到容器中  </span><br><span class="line"> $(opts.placeHolderTemplate).attr(&quot;data-droptarget&quot;, true).appendTo(this.container);  </span><br><span class="line"> else  </span><br><span class="line"> //placeHolderItem移除data-placeholder后克隆然后设置data-droptarget为true然后添加到容器中  </span><br><span class="line"> //list.placeHolderItem.clone().removeAttr(&quot;data-placeholder&quot;) crashes in IE7 and jquery 1.5.1 (doesn&apos;t in jquery 1.4.2 or IE8)  </span><br><span class="line"> $(this.container).append(list.placeHolderItem.removeAttr(&quot;data-placeholder&quot;).clone().attr(&quot;data-droptarget&quot;, true));  </span><br><span class="line"> //设置容器的placeHolderItem的data-placeholder属性为true  </span><br><span class="line"> list.placeHolderItem.attr(&quot;data-placeholder&quot;, true);  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;);  </span><br><span class="line"> &#125;  </span><br><span class="line"> &#125;;  </span><br><span class="line">  </span><br><span class="line"> newList.init(); //调用初始化方法  </span><br><span class="line"> lists.push(newList);  </span><br><span class="line"> &#125;);  </span><br><span class="line">  </span><br><span class="line"> return this;  </span><br><span class="line"> &#125;;  </span><br><span class="line">  </span><br><span class="line"> $.fn.dragsort.defaults = &#123;  </span><br><span class="line"> itemSelector: &quot;&quot;, //item选择器  </span><br><span class="line"> dragSelector: &quot;&quot;, //拖拽选择器  </span><br><span class="line"> dragSelectorExclude: &quot;input, textarea&quot;, //不能拖拽的元素  </span><br><span class="line"> dragEnd: function() &#123;&#125;, //drag结束时回调  </span><br><span class="line"> dragBetween: false,//容器之间是否可拖拽  </span><br><span class="line"> placeHolderTemplate: &quot;&quot;, //占位符模板  </span><br><span class="line"> scrollContainer: window, //滚动容器  </span><br><span class="line"> scrollSpeed: 5 //滚动速度（步长）  </span><br><span class="line"> &#125;;  </span><br><span class="line">  </span><br><span class="line">&#125;)(jQuery);</span><br></pre></td></tr></table></figure>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tages#移动端" >
    <span class="tag-code">移动端</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2015/12/15/h5-meta/">
        <span class="nav-arrow">← </span>
        
          h5 meta
        
      </a>
    
    
      <a class="nav-right" href="/2016/05/28/05-28-ios事件委托坑点/">
        
          ios事件委托坑点
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Gitment START -->
      <div id="comments"></div>
      <!-- Gitment END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'https://juzhishang.github.io/2016/05/17/05-17-jquery拖拽插件dragsortAPI/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

     // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', 'http://file.muyutech.com/error-img.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== 'http://file.muyutech.com/error-img.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()
        
        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })

    // qrcode
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });

    // gitment
    var gitmentConfig = "juzhishang";
    if (gitmentConfig !== 'undefined') {
      var gitment = new Gitment({
        id: "jquery拖拽插件dragsortAPI",
        owner: "juzhishang",
        repo: "juzhishang.github.io",
        oauth: {
          client_id: "19a4bb92d652487fe51f",
          client_secret: "1758eabb0def22e0a6b8edab473245799754c012"
        },
        theme: {
          render(state, instance) {
            const container = document.createElement('div')
            container.lang = "en-US"
            container.className = 'gitment-container gitment-root-container'
            container.appendChild(instance.renderHeader(state, instance))
            container.appendChild(instance.renderEditor(state, instance))
            container.appendChild(instance.renderComments(state, instance))
            container.appendChild(instance.renderFooter(state, instance))
            return container;
          }
        }
      })
      gitment.render(document.getElementById('comments'))
    }
  })();
</script>

    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2019 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a href="https://github.com/yanm1ng">yanm1ng</a>
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>
  </body>
</html>